<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steel Surge - FTC Robotics Team</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #38bdf8;
      --primary-dark: #0ea5e9;
      --primary-glow: rgba(56, 189, 248, 0.5);
      --accent: #7c3aed;
      --accent-glow: rgba(124, 58, 237, 0.5);
      --dark-bg: #030711;
      --card-bg: rgba(17, 24, 39, 0.7);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --nav-bg: rgba(3, 7, 18, 0.8);
    }
    [data-theme="light"] {
      --primary: #0ea5e9;
      --primary-dark: #38bdf8;
      --primary-glow: rgba(56, 189, 248, 0.18);
      --accent: #7c3aed;
      --accent-glow: rgba(124, 58, 237, 0.13);
      --dark-bg: #f1f5f9;
      --card-bg: #fff;
      --text-primary: #030711;
      --text-secondary: #334155;
      --nav-bg: #e0e7ef;
    }
    
    /* Add these CSS rules for section visibility */
    .content section {
      display: none !important;  /* Hide all sections by default */
    }
    
    .content section.active-section {
      display: block !important;  /* Show only active section */
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      background-color: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Rajdhani', sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }
    
    h1, h2, h3, h4, h5, h6, nav {
      font-family: 'Orbitron', sans-serif;
    }
    
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 0;
    }
    
    nav {
      background-color: var(--nav-bg);
      backdrop-filter: blur(12px);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      z-index: 1000; /* Higher z-index to ensure it's above everything */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      box-shadow: 0 4px 20px -5px rgba(56, 189, 248, 0.3);
      border-bottom: 1px solid rgba(56, 189, 248, 0.2);
      pointer-events: auto; /* Ensure clicks work */
    }
    
    nav h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--primary);
      text-shadow: 0 0 10px var(--primary-glow);
      position: relative;
      overflow: hidden;
    }
    
    nav h1::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      bottom: -2px;
      left: 0;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      animation: navGlow 3s infinite;
    }
    
    @keyframes navGlow {
      0%, 100% { opacity: 0.3; transform: translateX(-100%); }
      50% { opacity: 1; transform: translateX(100%); }
    }
    
    nav .links {
      display: flex;
      gap: 1.5rem;
    }
    
    nav .links a {
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-primary);
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      letter-spacing: 1px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    nav .links a::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: var(--primary);
      transform: translateX(-50%);
      transition: width 0.3s ease;
    }
    
    nav .links a:hover {
      color: var(--primary);
      text-shadow: 0 0 8px var(--primary-glow);
    }
    
    nav .links a:hover::before {
      width: 80%;
    }
    
    .content {
      padding-top: 7rem;
      padding-left: 2.5rem;
      padding-right: 2.5rem;
      max-width: 80rem;
      margin: 0 auto;
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }
    
    .content section {
      background: linear-gradient(120deg, rgba(17,24,39,0.92) 60%, rgba(56,189,248,0.07) 100%);
      border-radius: 1.5rem;
      box-shadow: 0 8px 32px 0 rgba(56,189,248,0.10), 0 1.5px 8px 0 rgba(124,58,237,0.08);
      padding: 2.5rem 2rem 2.5rem 2rem;
      margin-bottom: 0;
      border: 1.5px solid rgba(56,189,248,0.13);
      transition: box-shadow 0.3s, border 0.3s;
      display: none !important;
    }
    
    .content section.active-section {
      display: block !important;
      animation: fadeInUp 0.8s cubic-bezier(0.23,1,0.32,1) both;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 2.5rem;
      margin-top: 0.5rem;
      border-bottom: 1.5px solid rgba(56,189,248,0.13);
      padding-bottom: 1.2rem;
    }
    
    section h2 {
      font-size: 2.2rem;
      font-weight: 800;
      color: var(--primary);
      letter-spacing: 1.5px;
      margin-bottom: 0;
      text-shadow: 0 0 12px var(--primary-glow);
    }
    
    section h2::after {
      content: '';
      display: block;
      margin-top: 0.7rem;
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 3px;
    }
    
    .card {
      background: linear-gradient(120deg, var(--card-bg) 80%, var(--primary-glow) 100%);
      border-radius: 1.2rem;
      box-shadow: 0 4px 24px 0 rgba(56,189,248,0.10), 0 1.5px 8px 0 rgba(124,58,237,0.08);
      border: 1.5px solid rgba(56,189,248,0.13);
      padding: 2rem 1.5rem;
      margin-bottom: 0;
      transition: box-shadow 0.3s, border 0.3s, transform 0.2s;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      align-items: flex-start;
    }
    
    .card:hover {
      box-shadow: 0 8px 32px 0 rgba(56,189,248,0.18), 0 1.5px 8px 0 rgba(124,58,237,0.13);
      border-color: var(--primary);
      transform: translateY(-4px) scale(1.012);
    }
    
    .card h3 {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 0.5rem;
      text-shadow: 0 0 8px var(--primary-glow);
    }
    
    .card p {
      color: var(--text-secondary);
      line-height: 1.7;
      font-size: 1.08rem;
    }
    
    .card button, .back-btn, .achievement-card {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      letter-spacing: 1px;
      border-radius: 0.7rem;
      box-shadow: 0 2px 8px var(--primary-glow);
      transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.15s;
    }
    
    .card button:hover, .back-btn:hover {
      background: var(--primary-dark);
      color: #fff;
      box-shadow: 0 4px 16px var(--primary-glow);
      transform: scale(1.04);
    }
    
    .grid, .sponsors-grid {
      display: grid;
      gap: 2.2rem;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      margin-bottom: 0;
    }
    
    .sponsors-grid {
      gap: 1.5rem;
    }
    
    .achievement-card {
      background: linear-gradient(90deg, rgba(56,189,248,0.10), rgba(124,58,237,0.10));
      border: 2px solid #334155;
      border-radius: 1rem;
      padding: 1.2rem;
      display: flex;
      align-items: center;
      gap: 1.2rem;
      opacity: 0.95;
      margin-bottom: 0.7rem;
      font-size: 1.1rem;
    }
    
    .achievement-card[style*='rgba(56,189,248,0.15)'] {
      border: 2px solid #38bdf8;
      opacity: 1;
    }
    
    /* Responsive tweaks */
    @media (max-width: 900px) {
      .content {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .grid, .sponsors-grid {
        grid-template-columns: 1fr;
      }
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.7rem;
      }
    }
    
    .lightning-overlay {
      pointer-events: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
      overflow: hidden;
    }
    
    .lightning-bolt {
      position: absolute;
      opacity: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      filter: brightness(1.10) contrast(1.05); /* less intense */
      mix-blend-mode: screen;
      will-change: opacity, filter;
    }
    
    .bolt-1 {
      background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNjUsMTAgTDIwLDkwIEwzNSw1MCBMMTUsNTUgTDYwLDEwIEw0NSw1MCBMODUsNDUgTDY1LDEwIFoiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==') no-repeat center center;
      animation: flashBolt 18s infinite;
      animation-delay: 2s;
    }
    
    .bolt-2 {
      background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNDAsMTUgTDg1LDkwIEw2MCw1MCBMODAsNDUgTDM1LDEwIEw2MCw2MCBMMjAsNDUgTDQwLDE1IFoiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==') no-repeat center center;
      animation: flashBolt 22s infinite;
      animation-delay: 7s;
    }
    
    .lightning-effect {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, rgba(30, 58, 138, 0.03), rgba(59, 130, 246, 0.06), transparent);
      animation: ambientGlow 14s infinite alternate;
      mix-blend-mode: screen;
    }
    
    @keyframes ambientGlow {
      0%, 100% { opacity: 0.13; background-position: 0% 50%; }
      50% { opacity: 0.22; background-position: 100% 50%; }
    }
    
    @keyframes flashBolt {
      0%, 97% { opacity: 0; filter: brightness(1.10) blur(0px); }
      98%, 98.5% { opacity: 0.25; filter: brightness(1.13) blur(0.5px); }
      98.6%, 99% { opacity: 0.15; filter: brightness(1.08) blur(1px); }
      99.1%, 100% { opacity: 0; filter: brightness(1.05) blur(1.5px); }
    }
    
    .card {
      background-color: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 0.75rem;
      box-shadow: 
        0 20px 25px -5px rgba(0, 0, 0, 0.3),
        0 0 10px rgba(56, 189, 248, 0.2);
      transition: all 0.4s ease;
      padding: 1.75rem;
      margin-bottom: 1.5rem;
      overflow: hidden;
      position: relative;
    }
    
    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: all 0.7s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.5),
        0 0 15px rgba(56, 189, 248, 0.4);
      border-color: rgba(56, 189, 248, 0.4);
    }
    
    .card:hover::after {
      left: 100%;
    }
    
    .card h3 {
      font-size: 1.35rem;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 0.75rem;
      position: relative;
      display: inline-block;
    }
    
    .card h3::before {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 40px;
      height: 2px;
      background: var(--primary);
    }
    
    .card p {
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    .home-section, .about-section, .sponsors-section, .media-section, .blog-section {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .active-section {
      display: block;
      opacity: 1;
      transform: translateY(0);
      animation: fadeInUp 0.8s ease forwards;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    section h2 {
      position: relative;
      display: inline-block;
      margin-bottom: 1.5rem;
    }
    
    section h2::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 60px;
      height: 3px;
      background: var(--primary);
      border-radius: 3px;
    }
    
    .robot-container {
      position: absolute;
      bottom: 0;
      left: 0;
      z-index: 2;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    .robot {
      position: absolute;
      bottom: 0;
      left: 0;
      z-index: 2;
      filter: drop-shadow(0 0 15px rgba(56, 189, 248, 0.5));
      transition: transform 10s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .sponsors-grid img {
      filter: grayscale(80%);
      opacity: 0.7;
      transition: all 0.3s ease;
    }
    
    .sponsors-grid img:hover {
      filter: grayscale(0%);
      opacity: 1;
      transform: scale(1.05);
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      nav .links {
        gap: 0.5rem;
      }
      nav .links a {
        font-size: 0.75rem;
        padding: 0.3rem 0.5rem;
      }
      #nav-links {
        max-height: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
    }
    @media (min-width: 769px) {
      #nav-links {
        max-height: none !important;
        overflow: visible !important;
        display: flex !important;
        flex-direction: row !important;
      }
    }
    /* Accessibility Toolbar - always top right, above all content, visible in all themes */
    #accessibility-toolbar {
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      z-index: 99999;
      background: var(--nav-bg, #222);
      border: 2px solid var(--primary, #38bdf8);
      border-radius: 1.5rem 0 0 1.5rem;
      padding: 0.7rem 1.2rem 0.7rem 1.4rem;
      box-shadow: 0 2px 8px var(--primary-glow, #38bdf8);
      display: flex;
      align-items: center;
      gap: 1.2rem;
      min-width: 160px;
      max-width: 90vw;
      color: var(--text-primary, #fff);
      margin-right: 0;
    }
    #accessibility-toolbar button {
      color: var(--text-primary, #fff);
    }
    @media (max-width: 600px) {
      #accessibility-toolbar {
        top: 60%;
        right: 0;
        transform: translateY(-50%);
        padding: 0.5rem 0.7rem 0.5rem 1rem;
        font-size: 0.95rem;
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <noscript><div style="background:#f87171;color:#fff;padding:1rem;text-align:center;font-size:1.2rem;z-index:99999;position:fixed;top:0;left:0;width:100vw;">This site requires JavaScript to function properly. Please enable JavaScript in your browser.</div></noscript>
  <div id="accessibility-toolbar">
    <span style="color:var(--primary);font-weight:bold;">Accessibility:</span>
    <button id="theme-toggle" aria-label="Toggle light/dark mode" style="background:none;border:none;color:var(--text-primary);font-size:1.3rem;cursor:pointer;">🌙</button>
  </div>
  <div id="particles-js"></div>
  <div class="lightning-overlay">
    <div class="lightning-effect"></div>
    <div class="lightning-bolt bolt-1"></div>
    <div class="lightning-bolt bolt-2"></div>
  </div>
  <div id="robot-container" class="robot-container" style="display:none;"></div>
  <nav>
    <h1>Steel Surge</h1>
    <button id="nav-toggle" aria-label="Open navigation" class="md:hidden" style="background:none;border:none;color:var(--primary);font-size:2rem;cursor:pointer;position:absolute;right:1.5rem;top:1.2rem;z-index:101;">☰</button>
    <div class="links" id="nav-links" style="transition:max-height 0.4s;overflow:hidden;">
      <a href="#" data-section="home">Home</a>
      <a href="#" data-section="about">About</a>
      <a href="#" data-section="sponsors">Sponsors</a>
      <a href="#" data-section="media">Media</a>
      <a href="#" data-section="blog">Blog</a>
      <a href="#" data-section="games">Games</a>
      <a href="#" data-section="achievements">Achievements</a>
      <a href="#" data-section="strategy">Strategy</a>
      <a href="#" data-section="mentors">Mentors</a>
      <a href="#" data-section="dashboard">Team Info</a>
    </div>
  </nav>
  
  <div class="content">
    <section id="home" class="home-section active-section">
      <div class="text-center">
        <h2 class="text-4xl sm:text-5xl md:text-6xl font-bold text-sky-300 mb-6 animate__animated animate__fadeIn">Welcome to Steel Surge</h2>
        <p class="text-gray-300 text-xl max-w-2xl mx-auto animate__animated animate__fadeIn animate__delay-1s">An FTC Robotics team from Unionville-Chadds Ford School District pushing the boundaries of innovation.</p>
      </div>
    </section>
    
    <section id="about" class="about-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Meet Our Team</h2>
      </div>
      
      <!-- Team Overview -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        <div class="card">
          <h3>Our Team</h3>
          <p>We are a passionate group of students from Unionville-Chadds Ford School District, working together to push the boundaries of robotics innovation. Our diverse team brings together expertise in programming, mechanical engineering, CAD design, and outreach.</p>
        </div>
        <div class="card">
          <h3>Want To Join Us?</h3>
          <p>If you're interested in joining Steel Surge, FTC Team 27254, please fill out our interest form. We welcome passionate students who want to build, program, or help with outreach!
            <br><br>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSdQC0YLkmq89Ugf4htuhMzqHI2Yuu2PHIH78LA3hpsxYCE9UA/viewform" target="_blank" class="text-sky-400 hover:text-sky-300 font-bold hover:underline">Steel Surge Interest Form →</a>
          </p>
        </div>
      </div>

      <!-- Team Members Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Daniel Thomas -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/danielthomas.jpeg" alt="Daniel Thomas" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Daniel Thomas</h3>
          <p class="text-purple-400 font-medium mb-4">Head of Outreach/Business and Assistant Programmer</p>
          <p class="text-gray-300 mb-4">I am Steel Surge's Outreach and Business head, Assistant Programmer, and a student at Unionville Chadds Ford. My main activities are debate, robotics, tutoring, tech Olympics and Student government. I manage Steel Surge's communication, team socials, and other external activities.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:thomasd28@ucfsd.net" class="text-sky-400 hover:underline">thomasd28@ucfsd.net</a></p>
              <p class="text-sm text-gray-400">📧 <a href="mailto:danielpthomas3@icloud.com" class="text-sky-400 hover:underline">danielpthomas3@icloud.com</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:16104837734" class="text-sky-400 hover:underline">(610) 483-7734</a></p>
            </div>
          </div>
        </div>

        <!-- Idris Bhatti -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/idrisbhatti.jpeg" alt="Idris Bhatti" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Idris Bhatti</h3>
          <p class="text-purple-400 font-medium mb-4">Head of Mechanical Department</p>
          <p class="text-gray-300 mb-4">I am a highschooler at Unionville. My main hobbies are robotics and tennis. For Steel Surge, I am the head of Mechanical and I oversee and assist in the CAD, design, and the actual building of the robot departments.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:bhattii28@ucfsd.net" class="text-sky-400 hover:underline">bhattii28@ucfsd.net</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:6103681143" class="text-sky-400 hover:underline">(610) 368-1143</a></p>
            </div>
          </div>
        </div>

        <!-- Nikhil Kaza -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/nikhilkaza.jpeg" alt="Nikhil Kaza" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Nikhil Kaza</h3>
          <p class="text-purple-400 font-medium mb-4">Mechanical Department: Head of CAD</p>
          <p class="text-gray-300 mb-4">I am a 9th grader at Unionville High School. I am very passionate about STEM programs and education in general. I work as a mechanical (a head of CAD) and assist with other aspects of the team.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:nikoftime2020@outlook.com" class="text-sky-400 hover:underline">nikoftime2020@outlook.com</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:4847909539" class="text-sky-400 hover:underline">(484) 790-9539</a></p>
            </div>
          </div>
        </div>
        <!-- Ethan Harris -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/ethanharris.jpeg" alt="Ethan Harris" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Ethan Harris</h3>
          <p class="text-purple-400 font-medium mb-4">Mechanical Engineering & Outreach</p>
          <p class="text-gray-300 mb-4">I'm a new member of the team with previous experience. Currently I'm in 9th grade. Here on the team I use my experience in mechanical engineering and outreach but I'm up for trying anything. I wish to gain more experience building more complex builds with Steel Surge.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:Ethanjaiharris@outlook.com" class="text-sky-400 hover:underline">Ethanjaiharris@outlook.com</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:6104252912" class="text-sky-400 hover:underline">(610) 425-2912</a></p>
            </div>
          </div>
        </div>

        <!-- Nathan Thomas -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/nathanthomas.jpeg" alt="Nathan Thomas" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Nathan Thomas</h3>
          <p class="text-purple-400 font-medium mb-4">Head of Programming</p>
          <p class="text-gray-300 mb-4">I'm Nathan Thomas, Head of Programming at Steel Surge. I'm in 9th grade currently, and am studying at Unionville High School. This season will be my second year at Steel Surge.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:thomasn28@ucfsd.net" class="text-sky-400 hover:underline">thomasn28@ucfsd.net</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:6104839196" class="text-sky-400 hover:underline">(610) 483-9196</a></p>
            </div>
          </div>
        </div>

        <!-- Thomas Binder -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/thomasbinder.jpeg" alt="Thomas Binder" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Thomas Binder</h3>
          <p class="text-purple-400 font-medium mb-4">Mechanical Department: Assistant CAD Designer</p>
          <p class="text-gray-300 mb-4">I am a 9th grader from Unionville High school and I joined Steel Surge fairly recently. I assist members on the team in CAD, outreach, and programming. I help do things all around the team.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:bindert28@ucfsd.net" class="text-sky-400 hover:underline">bindert28@ucfsd.net</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:4848881989" class="text-sky-400 hover:underline">(484) 888-1989</a></p>
            </div>
          </div>
        </div>

        <!-- Rithwik Aluru -->
        <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700/50 hover:border-sky-500/50 transition-all duration-300 flex flex-col">
          <div class="w-32 h-32 mx-auto mb-4 overflow-hidden rounded-full border-2 border-sky-500/50">
            <img src="static/rithwikaluru.jpeg" alt="Rithwik Aluru" class="w-full h-full object-cover">
          </div>
          <h3 class="text-xl font-bold text-sky-400 mb-2 text-center">Rithwik Aluru</h3>
          <p class="text-purple-400 font-medium mb-4">Outreach</p>
          <p class="text-gray-300 mb-4">I am in 9th grade and I go to Unionville High School. I just recently joined Steel Surge and I am a new member of the team. I am currently helping with outreach, which involves finding sponsors to support us. I plan to help out with building the robot in the future.</p>
          <div class="mt-4 pt-4 border-t border-gray-700/50">
            <div class="space-y-2">
              <p class="text-sm text-gray-400">📧 <a href="mailto:alurur28@ucfsd.net" class="text-sky-400 hover:underline">alurur28@ucfsd.net</a></p>
              <p class="text-sm text-gray-400">📞 <a href="tel:3022942444" class="text-sky-400 hover:underline">(302) 294-2444</a></p>
            </div>
          </div>
        </div>
      </div>
    </section>

    </section>
    
    <section id="sponsors" class="sponsors-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Sponsors</h2>
      </div>
      <p class="text-gray-300 mb-8" style="font-size:1.13rem;line-height:1.7;max-width:48rem;margin:0 auto 2.5rem auto;">
        Hi! We're Team Steel Surge, a group of passionate middle and high school students competing in the FIRST Tech Challenge (FTC). Every season, we design, build, and program a robot to take on complex challenges—while also learning teamwork, leadership, and real-world engineering and coding skills.<br><br>
        We're reaching out to invite you to be part of our journey.<br><br>
        Running a robotics team takes resources: parts, tools, travel, outreach, and more. That's where you come in. With your support, we can keep building, learning, and sharing our love for STEM with the community.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mt-10 mb-12">
        <!-- Bronze -->
        <div class="card text-center shadow-lg border border-yellow-700" style="background:linear-gradient(135deg,#cd7f32 80%,#fff8e1 100%);font-weight:900;">
          <h4 class="text-2xl font-extrabold text-yellow-900 mb-2" style="letter-spacing:1px;">Bronze</h4>
          <div class="text-xl font-extrabold text-yellow-900 mb-2">$500</div>
          <div class="font-bold mb-2">Benefits:</div>
          <ul class="text-black list-disc list-inside mb-4 text-left mx-auto" style="max-width: 220px;font-weight:700;">
            <li>Recognition on social media.</li>
          </ul>
        </div>
        <!-- Silver -->
        <div class="card text-center shadow-lg border border-gray-400" style="background:linear-gradient(135deg,#c0c0c0 80%,#f8fafc 100%);font-weight:900;">
          <h4 class="text-2xl font-extrabold text-gray-700 mb-2" style="letter-spacing:1px;">Silver</h4>
          <div class="text-xl font-extrabold text-gray-700 mb-2">$1,000</div>
          <div class="font-bold mb-2">Benefits:</div>
          <ul class="text-black list-disc list-inside mb-4 text-left mx-auto" style="max-width: 220px;font-weight:700;">
            <li>Logo placement on team shirts.</li>
            <li>Recognition on social media.</li>
          </ul>
        </div>
        <!-- Gold -->
        <div class="card text-center shadow-lg border-2 border-yellow-400" style="background:linear-gradient(135deg,#ffd700 80%,#fffbe6 100%);font-weight:900;">
          <h4 class="text-2xl font-extrabold text-yellow-700 mb-2" style="letter-spacing:1px;">Gold</h4>
          <div class="text-xl font-extrabold text-yellow-700 mb-2">$5,000</div>
          <div class="font-bold mb-2">Benefits:</div>
          <ul class="text-black list-disc list-inside mb-4 text-left mx-auto" style="max-width: 220px;font-weight:700;">
            <li>Logo placement on team shirts.</li>
            <li>Recognition on social media.</li>
            <li>Shout-out on Website.</li>
          </ul>
        </div>
        <!-- Platinum -->
        <div class="card text-center shadow-lg border-2 border-gray-400" style="background:linear-gradient(135deg,#e5e4e2 80%,#f8fafc 100%);font-weight:900;">
          <h4 class="text-2xl font-extrabold text-gray-700 mb-2" style="letter-spacing:1px;">Platinum</h4>
          <div class="text-xl font-extrabold text-gray-700 mb-2">$10,000</div>
          <div class="font-bold mb-2">Benefits:</div>
          <ul class="text-black list-disc list-inside mb-4 text-left mx-auto" style="max-width: 220px;font-weight:700;">
            <li>Logo placement on team shirts.</li>
            <li>Recognition on social media and website.</li>
            <li>Company banner at events.</li>
            <li>Featured on the team's website.</li>
          </ul>
        </div>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 sponsors-grid">
        <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80" alt="Sponsor 1" class="rounded-lg hover:shadow-glow transition-all duration-300">
        <img src="https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80" alt="Sponsor 2" class="rounded-lg hover:shadow-glow transition-all duration-300">
        <img src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80" alt="Sponsor 3" class="rounded-lg hover:shadow-glow transition-all duration-300">
        <img src="https://images.unsplash.com/photo-1521737852567-6949f3f9f2b5?auto=format&fit=crop&w=400&q=80" alt="Sponsor 4" class="rounded-lg hover:shadow-glow transition-all duration-300">
      </div>
    </section>
    
    <section id="media" class="media-section">
      <h2 class="text-3xl md:text-4xl font-bold text-sky-300">Media</h2>
      <p class="text-gray-300 mb-8">Videos and social links</p>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 border border-sky-700/30">
          <iframe class="w-full h-72" src="https://www.youtube.com/embed?listType=playlist&list=UUEGxm1OMPQkqc5-hVhdEY4A" title="Steel Surge FTC YouTube Channel" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 border border-sky-700/30">
          <iframe class="w-full h-72" src="https://snapwidget.com/embed/sample" title="Instagram" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>
    </section>
    
    <section id="blog" class="blog-section">
      <h2 class="text-3xl md:text-4xl font-bold text-sky-300">Blog</h2>
      <div class="space-y-6 mt-6">
        <div class="card">
          <h3>Kickoff Day</h3>
          <p>We kicked off the new FTC season with a full team brainstorm and strategy session! The energy was high as we dissected this year's game challenge and began mapping our approach to robot design.</p>
        </div>
        <div class="card">
          <h3>Build Week 1</h3>
          <p>Initial drivetrain testing is underway. We're excited to try our new gear configuration, which should provide better torque for climbing obstacles while maintaining speed for scoring elements.</p>
        </div>
      </div>
    </section>
    <section id="games" class="games-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Games</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
        <!-- Surge Maze Game Card -->
        <div class="card" style="align-items:center;text-align:center;">
          <div style="font-size:3rem;">🔩</div>
          <h3>Surge Maze</h3>
          <p>Help Surge escape a randomly generated maze! Use the arrow keys to guide Surge to the yellow exit. Each play is a new challenge!</p>
          <button onclick="launchGame('surge-maze')" style="background:#38bdf8;color:#030711;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;box-shadow:0 2px 8px #38bdf8;">Play Surge Maze</button>
        </div>
        <!-- Pac-Man Game Card -->
        <div class="card" style="align-items:center;text-align:center;">
          <div style="font-size:3rem;">
            <svg width="48" height="48" viewBox="0 0 48 48"><circle cx="24" cy="24" r="22" fill="#fbbf24" stroke="#222" stroke-width="2"/><path d="M24 8a16 16 0 1 0 0 32c3.5 0 6.7-1 9.3-2.7L24 24V8z" fill="#fff"/><circle cx="32" cy="16" r="3" fill="#222"/></svg>
          </div>
          <h3>Pac-Man: Surge Edition</h3>
          <p>Play a high-def, original Pac-Man style game with a Steel Surge twist!</p>
          <button onclick="launchGame('pacman')" style="background:#fbbf24;color:#222;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;box-shadow:0 2px 8px #fbbf24;">Play Pac-Man</button>
        </div>
        <!-- Robot Builder Game Card -->
        <div class="card" style="align-items:center;text-align:center;">
          <div style="font-size:3rem;">
            <svg width="48" height="48" viewBox="0 0 48 48"><rect x="10" y="20" width="28" height="16" rx="4" fill="#7c3aed" stroke="#fff" stroke-width="2"/><rect x="16" y="8" width="16" height="12" rx="3" fill="#38bdf8" stroke="#fff" stroke-width="2"/><circle cx="16" cy="40" r="4" fill="#0ea5e9" stroke="#fff" stroke-width="2"/><circle cx="32" cy="40" r="4" fill="#0ea5e9" stroke="#fff" stroke-width="2"/></svg>
          </div>
          <h3>Robot Builder</h3>
          <p>Design and assemble your own robot in this interactive, high-graphic builder game. Share your creation!</p>
          <button onclick="launchGame('robot-builder')" style="background:#7c3aed;color:#fff;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;box-shadow:0 2px 8px #7c3aed;">Play Robot Builder</button>
        </div>
        <!-- Memory Circuit Game Card -->
        <div class="card" style="align-items:center;text-align:center;">
          <div style="font-size:3rem;">
            <svg width="48" height="48" viewBox="0 0 48 48"><rect x="8" y="8" width="32" height="32" rx="8" fill="#0ea5e9" stroke="#fff" stroke-width="2"/><rect x="16" y="16" width="16" height="16" rx="4" fill="#fff" stroke="#7c3aed" stroke-width="2"/><circle cx="24" cy="24" r="4" fill="#7c3aed"/></svg>
          </div>
          <h3>Memory Circuit</h3>
          <p>Test your memory and speed in this original, high-graphic circuit-matching game!</p>
          <button onclick="launchGame('memory-circuit')" style="background:#0ea5e9;color:#fff;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;box-shadow:0 2px 8px #0ea5e9;">Play Memory Circuit</button>
        </div>
      </div>
    </section>
    <section id="achievements" class="achievements-section">
      <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;">
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Achievements</h2>
        <label style="display:flex;align-items:center;gap:0.5rem;font-size:1.1rem;color:#38bdf8;cursor:pointer;">
          <input type="checkbox" id="achievements-toggle" style="accent-color:#38bdf8;width:1.2rem;height:1.2rem;" checked>
          Enable Achievements
        </label>
      </div>
      <div id="achievements-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-6"></div>
    </section>
    <section id="strategy" class="strategy-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Strategy Simulator</h2>
      </div>
      <div class="card">
        <h3>FTC Game Strategy Simulator</h3>
        <p>Plan your match strategy! Visualize scoring, test different robot roles, and optimize your alliance's path to victory. (Coming soon!)</p>
      </div>
    </section>
    <section id="mentors" class="mentors-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Mentor Wall</h2>
      </div>
      <div class="card">
        <h3>Meet Our Mentors</h3>
        <ul style="color:#f1f5f9;list-style:disc;padding-left:1.5rem;">
          <li>Jane Doe – Mechanical Engineering</li>
          <li>John Smith – Programming & Controls</li>
          <li>Alex Lee – Outreach & Strategy</li>
        </ul>
      </div>
    </section>
    <section id="dashboard" class="dashboard-section">
      <div class="section-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem;margin-top:0.5rem;">
        <button class="back-btn" aria-label="Back to Home" onclick="navigateBack()" tabindex="0" style="background:rgba(30,41,59,0.9);color:#38bdf8;border:none;border-radius:0.7rem;padding:0.5rem 1.2rem;font-size:1rem;box-shadow:0 2px 8px #38bdf8;cursor:pointer;z-index:10;">← Back</button>
        <h2 class="text-3xl md:text-4xl font-bold text-sky-300" style="margin-bottom:0;">Team Info</h2>
      </div>
      <div class="card">
        <h3>Team Stats</h3>
        <ul style="color:#f1f5f9;list-style:disc;padding-left:1.5rem;">
          <li>Current Season: 2024-2025</li>
          <li>Events Attended: 3</li>
          <li>Matches Played: 12</li>
          <li>Outreach Hours: 40+</li>
          <li><a href="https://ftcscout.org/teams/27254" target="_blank" style="color:#38bdf8;text-decoration:underline;">View more stats for Steel Surge on FTC Scout</a></li>
        </ul>
      </div>
      <div class="card">
        <h3>Quick Links</h3>
        <ul style="color:#f1f5f9;list-style:disc;padding-left:1.5rem;">
          <li><a href="https://www.firstinspires.org/robotics/ftc" target="_blank" style="color:#38bdf8;text-decoration:underline;">FTC Official Site</a></li>
          <li><a href="#" style="color:#38bdf8;text-decoration:underline;">Team Calendar</a></li>
          <li><a href="mailto:surgesteel1@gmail.com" style="color:#38bdf8;text-decoration:underline;">Contact Us</a></li>
        </ul>
      </div>
    </section>
  </div>
  
  <script>
    // Particles.js configuration
    document.addEventListener('DOMContentLoaded', () => {
      let particleSize = 3; // Ensure particleSize is defined
      particlesJS('particles-js', {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": "#38bdf8"
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.4,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 1,
              "opacity_min": 0.1,
              "sync": false
            }
          },
          "size": {
            "value": particleSize,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 2,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#38bdf8",
            "opacity": 0.2,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 0.8,
            "direction": "none",
            "random": true,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": false,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 0.5
              }
            },
            "push": {
              "particles_nb": 3
            }
          }
        },
        "retina_detect": true
      });
    });
    
    // Thunder audio effect
    function setupThunderAudio() {
    const audio = new Audio('https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7c7.mp3');
      function playThunder() {
      audio.currentTime = 0;
        audio.volume = 0.6;
        audio.play().catch(err => console.log('Audio play failed:', err));
        // Fire lightningStrike event for robot power-up
        const evt = new Event('lightningStrike');
        window.dispatchEvent(evt);
      }
      setInterval(() => {
      if (Math.random() < 0.3) playThunder();
      }, 12000);
    }
    
    // Advanced robot animation
    function createRobot() {
      const robotContainer = document.getElementById('robot-container');
      const robot = document.createElement('div');
      robot.className = 'robot';
      robot.style.position = 'fixed';
      robot.style.right = '32px';
      robot.style.bottom = '32px';
      robot.style.zIndex = '9999';
      robot.style.cursor = 'pointer';
      robot.style.pointerEvents = 'auto';
      robot.style.willChange = 'transform, filter';
      robotContainer.style.pointerEvents = 'none'; // container is transparent to pointer
      robotContainer.appendChild(robot);

      // Facial expressions
      const expressions = [
        {
          name: 'smile',
          mouth: '<path d="M68 62 Q80 78 92 62" stroke="#fff" stroke-width="3" fill="none" stroke-linecap="round"/>',
          leftEye: '<path d="M62 44 Q65 48 68 44" stroke="black" stroke-width="2.2" fill="none" stroke-linecap="round" />',
          rightEye: '<path d="M92 44 Q95 48 98 44" stroke="black" stroke-width="2.2" fill="none" stroke-linecap="round" />',
          blush: true
        },
        {
          name: 'open',
          mouth: '<ellipse cx="80" cy="65" rx="8" ry="6" fill="#fff" stroke="#fff" stroke-width="2"/>',
          leftEye: '<ellipse cx="65" cy="45" rx="5" ry="7" fill="black" />',
          rightEye: '<ellipse cx="95" cy="45" rx="5" ry="7" fill="black" />',
          blush: false
        },
        {
          name: 'neutral',
          mouth: '<line x1="72" y1="65" x2="88" y2="65" stroke="#fff" stroke-width="3" stroke-linecap="round"/>',
          leftEye: '<ellipse cx="65" cy="45" rx="5" ry="5" fill="black" />',
          rightEye: '<ellipse cx="95" cy="45" rx="5" ry="5" fill="black" />',
          blush: false
        },
        {
          name: 'wink',
          mouth: '<path d="M68 62 Q80 78 92 62" stroke="#fff" stroke-width="3" fill="none" stroke-linecap="round"/>',
          leftEye: '<path d="M62 44 Q65 48 68 44" stroke="black" stroke-width="2.2" fill="none" stroke-linecap="round" />',
          rightEye: '<ellipse cx="95" cy="45" rx="5" ry="5" fill="black" />',
          blush: true
        },
        {
          name: 'surprised',
          mouth: '<ellipse cx="80" cy="65" rx="4" ry="7" fill="#fff" stroke="#fff" stroke-width="2"/>',
          leftEye: '<ellipse cx="65" cy="45" rx="6" ry="6" fill="black" />',
          rightEye: '<ellipse cx="95" cy="45" rx="6" ry="6" fill="black" />',
          blush: false
        },
        // New expressions
        {
          name: 'excited',
          mouth: '<path d="M70 62 Q80 85 90 62" stroke="#fff" stroke-width="3" fill="none" stroke-linecap="round"/>',
          leftEye: '<ellipse cx="65" cy="45" rx="6" ry="6" fill="#7c3aed" />',
          rightEye: '<ellipse cx="95" cy="45" rx="6" ry="6" fill="#7c3aed" />',
          blush: true
        },
        {
          name: 'thinking',
          mouth: '<ellipse cx="80" cy="68" rx="6" ry="2" fill="#fff" stroke="#fff" stroke-width="2"/>',
          leftEye: '<ellipse cx="63" cy="45" rx="4" ry="4" fill="black" />',
          rightEye: '<ellipse cx="97" cy="45" rx="4" ry="4" fill="black" />',
          blush: false
        }
      ];
      let currentExpression = 0;
      window.surgeClickCount = window.surgeClickCount || 0;
      window.surgePacmanShown = window.surgePacmanShown || false;
      let poweredUp = false;

      function getFaceSVG(expr) {
        return `
          ${expr.leftEye}
          <circle cx="65" cy="45" r="2" fill="#7c3aed" filter="url(#glow)" />
          ${expr.rightEye}
          <circle cx="95" cy="45" r="2" fill="#7c3aed" filter="url(#glow)" />
          ${expr.mouth}
          ${expr.blush ? '<ellipse cx="60" cy="58" rx="4" ry="2" fill="#fca5a5" opacity="0.5" /><ellipse cx="100" cy="58" rx="4" ry="2" fill="#fca5a5" opacity="0.5" />' : ''}
        `;
      }

      function renderRobotFace(exprIdx) {
        const expr = expressions[exprIdx];
        // Remove all children except the speech bubble (if present)
        const bubble = robot.querySelector('.speech-bubble');
        robot.innerHTML = '';
        const svg = document.createElement('div');
        svg.innerHTML = `
        <svg viewBox="0 0 160 140" width="120" height="120">
          <defs>
            <linearGradient id="robotBody" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#f0f9ff" />
              <stop offset="100%" stop-color="#38bdf8" />
            </linearGradient>
            <linearGradient id="robotHead" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#f0f9ff" />
              <stop offset="100%" stop-color="#0ea5e9" />
            </linearGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          <rect x="30" y="60" width="100" height="60" rx="12" fill="url(#robotBody)" stroke="#f0f9ff" stroke-width="1.5" filter="url(#glow)" />
          <rect x="45" y="65" width="70" height="5" rx="2" fill="rgba(255,255,255,0.3)" />
          <rect x="45" y="75" width="70" height="2" rx="1" fill="rgba(255,255,255,0.2)" />
          <rect x="55" y="83" width="50" height="3" rx="1.5" fill="rgba(255,255,255,0.25)" />
          <rect x="60" y="105" width="40" height="8" rx="4" fill="rgba(0,0,0,0.3)" />
          <rect x="50" y="30" width="60" height="30" rx="8" fill="url(#robotHead)" stroke="#f0f9ff" stroke-width="1.5" filter="url(#glow)" />
          <circle cx="50" cy="125" r="10" fill="#1e3a8a" stroke="#f0f9ff" stroke-width="1" />
          <circle cx="70" cy="125" r="10" fill="#1e3a8a" stroke="#f0f9ff" stroke-width="1" />
          <circle cx="90" cy="125" r="10" fill="#1e3a8a" stroke="#f0f9ff" stroke-width="1" />
          <circle cx="110" cy="125" r="10" fill="#1e3a8a" stroke="#f0f9ff" stroke-width="1" />
          <circle cx="50" cy="125" r="4" fill="#0f172a" />
          <circle cx="70" cy="125" r="4" fill="#0f172a" />
          <circle cx="90" cy="125" r="4" fill="#0f172a" />
          <circle cx="110" cy="125" r="4" fill="#0f172a" />
          ${getFaceSVG(expr)}
          <line x1="60" y1="30" x2="55" y2="15" stroke="#f0f9ff" stroke-width="2" />
          <circle cx="55" cy="15" r="2" fill="#7c3aed" filter="url(#glow)" />
          <line x1="100" y1="30" x2="105" y2="15" stroke="#f0f9ff" stroke-width="2" />
          <circle cx="105" cy="15" r="2" fill="#7c3aed" filter="url(#glow)" />
        </svg>
        `;
        robot.appendChild(svg.firstElementChild);
        if (bubble) robot.appendChild(bubble);
      }

      renderRobotFace(currentExpression);

      // Speech bubble
      let speechBubble = document.createElement('div');
      speechBubble.className = 'speech-bubble';
      speechBubble.style.position = 'absolute';
      speechBubble.style.right = '130px';
      speechBubble.style.bottom = '80px';
      speechBubble.style.background = 'rgba(30,41,59,0.97)';
      speechBubble.style.color = '#f0f9ff';
      speechBubble.style.padding = '0.7rem 1.2rem';
      speechBubble.style.borderRadius = '1rem';
      speechBubble.style.fontFamily = 'Rajdhani, sans-serif';
      speechBubble.style.fontSize = '1.1rem';
      speechBubble.style.boxShadow = '0 2px 8px #38bdf8';
      speechBubble.style.zIndex = '10001';
      speechBubble.style.opacity = '0.97';
      speechBubble.style.pointerEvents = 'none';
      speechBubble.style.transition = 'opacity 0.4s';
      speechBubble.innerHTML = 'Hi! I\'m Surge!';
      robot.appendChild(speechBubble);
      // Each message is paired with an expression index
      const messages = [
        { text: "Hi! I'm Surge, your Steel Surge teammate!", expression: 0 }, // smile
        { text: "Steel Surge: Building tomorrow's engineers!", expression: 4 }, // excited
        { text: "Did you know? Our robot is designed and built by students!", expression: 1 }, // open
        { text: "FTC is all about teamwork, creativity, and innovation.", expression: 2 }, // neutral
        { text: "We love solving real-world problems with robotics!", expression: 4 }, // excited
        { text: "Unionville-Chadds Ford—home of Steel Surge!", expression: 0 }, // smile
        { text: "Our mission: Inspire, innovate, and compete.", expression: 4 }, // excited
        { text: "Ask me about our outreach and STEM events!", expression: 1 }, // open
        { text: "Every part on our robot has a purpose.", expression: 5 }, // thinking
        { text: "Keep pushing boundaries—just like Steel Surge!", expression: 4 }, // excited
        { text: "Robotics is more than building—it's learning and growing.", expression: 2 }, // neutral
        { text: "Go Steel Surge! Proud to be FTC Team 2024!", expression: 4 }, // excited
        { text: "Curious about our robot? Click me for a surprise!", expression: 3 }, // wink
      ];
      let msgIdx = 0;
      let messageInterval = null;
      let randomExpressionAllowed = true;
      function setMessageAndExpression(idx) {
        msgIdx = idx % messages.length;
        speechBubble.innerHTML = messages[msgIdx].text;
        currentExpression = messages[msgIdx].expression;
        renderRobotFace(currentExpression);
        randomExpressionAllowed = false;
        setTimeout(() => { randomExpressionAllowed = true; }, 3500);
      }
      setMessageAndExpression(0);
      messageInterval = setInterval(() => {
        setMessageAndExpression(msgIdx + 1);
      }, 6000);

      // Powered up animation
      function powerUpRobot() {
        if (poweredUp) return;
        poweredUp = true;
        robot.style.filter = 'drop-shadow(0 0 40px #38bdf8) brightness(1.3)';
        robot.style.transform = 'scale(1.08) rotate(-3deg)';
        speechBubble.innerHTML = "I'm powered up! ⚡";
        setTimeout(() => {
          robot.style.filter = '';
          robot.style.transform = '';
          poweredUp = false;
        }, 1800);
      }

      // Listen for lightning events
      window.addEventListener('lightningStrike', powerUpRobot);

      // Smoother idle animation (gentle floating)
      function animateRobotFloat() {
        robot.animate([
          { transform: 'translateY(0px) scale(1)' },
          { transform: 'translateY(-8px) scale(1.01)' },
          { transform: 'translateY(0px) scale(1)' },
          { transform: 'translateY(6px) scale(0.99)' },
          { transform: 'translateY(0px) scale(1)' }
        ], {
          duration: 4200,
          iterations: Infinity
        });
      }
      animateRobotFloat();

      // Random expression changes
      setInterval(() => {
        if (!poweredUp && randomExpressionAllowed && Math.random() < 0.25) {
          let next;
          do {
            next = Math.floor(Math.random() * expressions.length);
          } while (next === currentExpression);
          currentExpression = next;
          renderRobotFace(currentExpression);
        }
      }, 7000);

      // Occasional background event: shooting star
      function spawnShootingStar() {
        const star = document.createElement('div');
        star.style.position = 'fixed';
        star.style.top = Math.random() * 40 + 10 + 'vh';
        star.style.left = '-60px';
        star.style.width = '60px';
        star.style.height = '3px';
        star.style.background = 'linear-gradient(90deg, #fff 0%, #38bdf8 100%)';
        star.style.opacity = '0.8';
        star.style.borderRadius = '2px';
        star.style.zIndex = '100';
        star.style.pointerEvents = 'none';
        document.body.appendChild(star);
        const anim = star.animate([
          { left: '-60px', opacity: 0.8 },
          { left: '110vw', opacity: 0.1 }
        ], {
          duration: 1800 + Math.random() * 1200,
          easing: 'ease-in',
        });
        anim.onfinish = () => star.remove();
        setTimeout(() => star.remove(), 2500);
      }
      // Adjust shooting star interval for low-power devices
      let shootingStarInterval = 6000;
      if (navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 2) {
        shootingStarInterval = 12000;
      }
      setInterval(() => {
        if (Math.random() < 0.18) spawnShootingStar();
      }, shootingStarInterval);

      // Interactive particles: follow mouse
      document.addEventListener('mousemove', (e) => {
        if(window.pJSDom&&window.pJSDom[0]){
          const pJS = window.pJSDom[0].pJS;
          if(pJS && pJS.particles && pJS.particles.move){
            pJS.interactivity.mouse.pos_x = e.clientX;
            pJS.interactivity.mouse.pos_y = e.clientY;
          }
        }
      });

      // User interaction: click or hover to change expression
      function changeExpressionRandom() {
        let next;
        do {
          next = Math.floor(Math.random() * expressions.length);
        } while (next === currentExpression);
        currentExpression = next;
        renderRobotFace(currentExpression);
      }
      robot.addEventListener('mouseenter', () => {
        currentExpression = 3; // wink
        renderRobotFace(currentExpression);
      });
      robot.addEventListener('mouseleave', () => {
        currentExpression = 0; // smile
        renderRobotFace(currentExpression);
      });

      // Pac-Man modal
      function showPacmanModal() {
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100vw';
        modal.style.height = '100vh';
        modal.style.background = 'rgba(10,20,40,0.85)';
        modal.style.zIndex = '10000';
        modal.style.display = 'flex';
        modal.style.flexDirection = 'column';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.innerHTML = `
          <div style="background:rgba(30,41,59,0.95);padding:2rem 2.5rem;border-radius:1.5rem;box-shadow:0 8px 32px #000;display:flex;flex-direction:column;align-items:center;">
            <h2 style="color:#38bdf8;font-size:2rem;font-family:'Orbitron',sans-serif;margin-bottom:1rem;">Mini Game Unlocked!</h2>
            <p style="color:#fff;margin-bottom:1.5rem;">You clicked the robot 10 times!<br>Play a Pac-Man style game?</p>
            <button id="play-pacman-btn" style="background:#38bdf8;color:#030711;font-weight:bold;font-size:1.2rem;padding:0.7rem 2.2rem;border:none;border-radius:0.7rem;cursor:pointer;box-shadow:0 2px 8px #38bdf8;">Play Pac-Man</button>
            <button id="close-pacman-btn" style="margin-top:1.2rem;background:#222;color:#fff;font-size:1rem;padding:0.5rem 1.5rem;border:none;border-radius:0.5rem;cursor:pointer;">Close</button>
            <div id="pacman-canvas-container" style="margin-top:2rem;display:none;"></div>
      </div>
        `;
        document.body.appendChild(modal);
        document.getElementById('close-pacman-btn').onclick = () => modal.remove();
        document.getElementById('play-pacman-btn').onclick = () => {
          document.getElementById('pacman-canvas-container').style.display = 'block';
          document.getElementById('play-pacman-btn').style.display = 'none';
          try {
            if (typeof startPacmanGame === 'function') {
              startPacmanGame(document.getElementById('pacman-canvas-container'));
            } else {
              console.error('[ERROR] startPacmanGame is not defined!');
            }
          } catch (e) {
            console.error('[ERROR] Exception in startPacmanGame:', e);
          }
        };
      }

      // Attach a single click event to the robot-container for event delegation (inside createRobot)
      robot.addEventListener('click', (e) => {
        window.surgeClickCount++;
        if (!window.surgePacmanShown && window.surgeClickCount >= 10) {
          showPacmanModal();
          window.surgePacmanShown = true;
          unlockAchievement('tenClicks');
        } else {
          changeExpressionRandom();
          if (window.surgeClickCount === 1) unlockAchievement('firstClick');
        }
      });
    }

    // Move startPacmanGameHD to global scope
    function startPacmanGameHD(container) {
      // Simple Maze Game with Random Maze Generation
      container.innerHTML = `<canvas id="surge-maze-canvas" tabindex="0" aria-label="Surge Maze Game" style="background:#030711;border-radius:1rem;box-shadow:0 0 24px #38bdf8;width:100%;max-width:600px;max-height:80vw;outline:none;"></canvas>
      <div id="surge-maze-ui" style="color:#fff;text-align:center;margin-top:1rem;"></div>`;
      const canvas = container.querySelector('#surge-maze-canvas');
      const ctx = canvas.getContext('2d');
      // Responsive sizing
      function resizeCanvas() {
        let w = Math.min(600, window.innerWidth * 0.95);
        let h = Math.min(500, window.innerHeight * 0.7);
        canvas.width = w;
        canvas.height = h;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      // Maze generation (recursive backtracking)
      const MAZE_ROWS = 15, MAZE_COLS = 21;
      function generateMaze(rows, cols) {
        // 0 = wall, 1 = path
        let maze = Array.from({length: rows}, () => Array(cols).fill(0));
        function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }
        function carve(x, y) {
          maze[y][x] = 1;
          let dirs = [[0,-2],[2,0],[0,2],[-2,0]];
          shuffle(dirs);
          for (const [dx, dy] of dirs) {
            let nx = x + dx, ny = y + dy;
            if (ny > 0 && ny < rows && nx > 0 && nx < cols && maze[ny][nx] === 0) {
              maze[y + dy/2][x + dx/2] = 1;
              carve(nx, ny);
            }
          }
        }
        carve(1, 1);
        // Ensure entrance and exit
        maze[1][1] = 1; // Start
        maze[rows-2][cols-2] = 1; // Exit
        return maze;
      }
      let maze = generateMaze(MAZE_ROWS, MAZE_COLS);
      let cellSize = Math.min(canvas.width / MAZE_COLS, canvas.height / MAZE_ROWS);
      let player = {x: 1, y: 1};
      let exit = {x: MAZE_COLS-2, y: MAZE_ROWS-2};
      let gameOver = false;

      function drawMaze() {
        for (let y = 0; y < MAZE_ROWS; y++) for (let x = 0; x < MAZE_COLS; x++) {
          if (maze[y][x] === 0) {
            ctx.fillStyle = '#0ea5e9';
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
          }
        }
        // Draw exit
        ctx.save();
        ctx.fillStyle = '#fbbf24';
        ctx.beginPath();
        ctx.arc(exit.x * cellSize + cellSize/2, exit.y * cellSize + cellSize/2, cellSize/3, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
      function drawSurge(px, py) {
        ctx.save();
        ctx.translate(px * cellSize + cellSize/2, py * cellSize + cellSize/2);
        ctx.beginPath();
        ctx.arc(0, 0, cellSize/2-2, 0, Math.PI*2);
        ctx.fillStyle = '#38bdf8';
        ctx.shadowColor = '#7c3aed';
        ctx.shadowBlur = 8;
        ctx.fill();
        ctx.beginPath(); ctx.arc(-cellSize/5,-cellSize/6,cellSize/8,0,Math.PI*2); ctx.arc(cellSize/5,-cellSize/6,cellSize/8,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
        ctx.beginPath(); ctx.arc(-cellSize/5,-cellSize/7,cellSize/20,0,Math.PI); ctx.arc(cellSize/5,-cellSize/7,cellSize/20,0,Math.PI); ctx.strokeStyle='#222'; ctx.lineWidth=cellSize/30; ctx.stroke();
        ctx.beginPath(); ctx.arc(0,cellSize/7,cellSize/4,0,Math.PI,false); ctx.strokeStyle='#fff'; ctx.lineWidth=cellSize/18; ctx.stroke();
        ctx.restore();
      }
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        cellSize = Math.min(canvas.width / MAZE_COLS, canvas.height / MAZE_ROWS);
        drawMaze();
        drawSurge(player.x, player.y);
      }
      function canMove(x, y) {
        return maze[y] && maze[y][x] === 1;
      }
      function movePlayer(dx, dy) {
        if (canMove(player.x + dx, player.y + dy)) {
          player.x += dx; player.y += dy;
          if (player.x === exit.x && player.y === exit.y) {
            gameOver = true;
            showEndScreen();
          }
        }
      }
      function showEndScreen() {
        const ui = container.querySelector('#surge-maze-ui');
        ui.innerHTML = `<h3 style='color:#38bdf8'>You Win! Surge escaped the maze!</h3><button id='play-again-btn' style='margin:1rem 0.5rem 0 0;background:#38bdf8;color:#030711;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;'>Play Again</button><button id='close-game-btn' style='margin:1rem 0 0 0.5rem;background:#222;color:#fff;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;'>Close</button>`;
        document.getElementById('play-again-btn').onclick = () => { startPacmanGameHD(container); };
        document.getElementById('close-game-btn').onclick = () => { container.parentElement.parentElement.remove(); };
      }
      // Accessibility: focus canvas, keyboard controls
      canvas.focus();
      canvas.setAttribute('role','application');
      canvas.setAttribute('aria-label','Surge Maze Game');
      canvas.addEventListener('keydown', function handler(e) {
        if (gameOver) return;
        if(['ArrowUp','w','W'].includes(e.key)) movePlayer(0, -1);
        else if(['ArrowDown','s','S'].includes(e.key)) movePlayer(0, 1);
        else if(['ArrowLeft','a','A'].includes(e.key)) movePlayer(-1, 0);
        else if(['ArrowRight','d','D'].includes(e.key)) movePlayer(1, 0);
        draw();
      });
      draw();
      const ui = container.querySelector('#surge-maze-ui');
      ui.innerHTML = `<b>Goal:</b> Help Surge reach the yellow exit!`;
    }

    // Add Pac-Man button
    let pacmanBtn = document.createElement('button');
    pacmanBtn.id = 'pacman-fab';
    pacmanBtn.title = 'Play Pac-Man!';
    pacmanBtn.innerHTML = `<svg width="38" height="38" viewBox="0 0 38 38"><circle cx="19" cy="19" r="19" fill="#fbbf24"/><path d="M19 7a12 12 0 1 0 0 24c2.5 0 4.8-0.7 6.7-2l-6.7-10V7z" fill="#fff"/><circle cx="24" cy="14" r="2" fill="#222"/></svg>`;
    pacmanBtn.style.position = 'fixed';
    pacmanBtn.style.right = '40px';
    pacmanBtn.style.bottom = '170px';
    pacmanBtn.style.zIndex = '10002';
    pacmanBtn.style.background = 'rgba(30,41,59,0.97)';
    pacmanBtn.style.border = 'none';
    pacmanBtn.style.borderRadius = '50%';
    pacmanBtn.style.boxShadow = '0 2px 12px #fbbf24, 0 0 0 4px rgba(251,191,36,0.15)';
    pacmanBtn.style.padding = '0.5rem';
    pacmanBtn.style.cursor = 'pointer';
    pacmanBtn.style.transition = 'transform 0.2s';
    pacmanBtn.onmouseenter = () => pacmanBtn.style.transform = 'scale(1.12)';
    pacmanBtn.onmouseleave = () => pacmanBtn.style.transform = 'scale(1)';
    document.body.appendChild(pacmanBtn);
    pacmanBtn.onclick = (e) => {
      e.stopPropagation();
      showPacmanModal();
    };
  
  
  // Enhanced navigation with transitions and accessibility
  function setupNavigation() {
    const navToggle = document.getElementById('nav-toggle');
    const navLinks = document.getElementById('nav-links');
    const links = navLinks.querySelectorAll('a');

    // Function to switch active section
    function switchSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.content section').forEach(section => {
        section.classList.remove('active-section');
      });

      // Show target section
      const targetSection = document.getElementById(sectionId);
      if (targetSection) {
        targetSection.classList.add('active-section');
        targetSection.scrollIntoView({behavior: 'smooth', block: 'start'});
      }

      // Update navigation
      links.forEach(link => {
        link.classList.toggle('active', link.getAttribute('data-section') === sectionId);
      });

      // Handle home extras
      if (typeof showHomeExtras === 'function') {
        showHomeExtras(sectionId === 'home');
      }
    }

    // Handle navigation clicks
    links.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const sectionId = link.getAttribute('data-section');
        switchSection(sectionId);
      });
    });

    // Make switchSection available globally
    window.switchSection = switchSection;

    // Global back navigation function
    window.navigateBack = function() {
      switchSection('home');
    };

    // Mobile nav toggle
    navToggle.addEventListener('click', () => {
      const isExpanded = navLinks.style.maxHeight !== '0px' && navLinks.style.maxHeight !== '';
      navLinks.style.maxHeight = isExpanded ? '0px' : navLinks.scrollHeight + 'px';
      navToggle.setAttribute('aria-label', isExpanded ? 'Open navigation' : 'Close navigation');
    });

    // Handle resize
    window.addEventListener('resize', () => {
      navLinks.style.maxHeight = window.innerWidth >= 768 ? '' : '0px';
    });
  }
  
  // Initialize everything when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    setupThunderAudio();
    setupNavigation();
    
    // Show home section initially
    switchSection('home');
    
    // Only show robot and Pac-Man on Home
    function showHomeExtras(show) {
      const robotContainer = document.getElementById('robot-container');
      if (show) {
        robotContainer.style.display = '';
        robotContainer.innerHTML = '';
        createRobot();
      } else {
        robotContainer.style.display = 'none';
        robotContainer.innerHTML = '';
        let pacmanBtn = document.getElementById('pacman-fab');
        if (pacmanBtn) pacmanBtn.remove();
      }
    }
    window.showHomeExtras = showHomeExtras; // Make available globally
    // Initial state: show only home section
    document.querySelectorAll('.content section').forEach(section => {
      section.classList.remove('active-section');
      section.style.display = 'none';
    });
    const home = document.getElementById('home');
    if (home) {
      home.classList.add('active-section');
      home.style.display = '';
    }
    // Set nav active state
    const navLinks = document.getElementById('nav-links');
    if (navLinks) {
      navLinks.querySelectorAll('a').forEach(link => {
        if (link.getAttribute('data-section') === 'home') link.classList.add('active');
        else link.classList.remove('active');
  
      });
    }
    // Accessibility toolbar theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    function setTheme(mode) {
      if (mode === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        themeToggle.textContent = '☀️';
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '🌙';
        localStorage.setItem('theme', 'dark');
      }
      console.log('Theme set to', mode);
    }
    // Detect system preference
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');
    setTheme(savedTheme || (prefersDark ? 'dark' : 'light'));
    themeToggle.onclick = () => {
      const current = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
      setTheme(current === 'dark' ? 'light' : 'dark');
    };
    // Fallback: ensure accessibility toolbar is always visible
    setTimeout(() => {
      const acc = document.getElementById('accessibility-toolbar');
      if (acc && (acc.style.display === 'none' || window.getComputedStyle(acc).display === 'none')) {
        acc.style.display = 'flex';
      }
    }, 100);
  });

  // Make lightning less intense
  const lightningEffect = document.querySelector('.lightning-effect');
  if (lightningEffect) lightningEffect.style.opacity = '0.08';
  const bolts = document.querySelectorAll('.lightning-bolt');
  bolts.forEach(bolt => {
    bolt.style.opacity = '0.07';
  });

  // Randomize bolt animation delays
  bolts.forEach((bolt,i)=>{
    bolt.style.animationDelay = (Math.random()*12+6*i)+'s';
  });

  // Interactive particles: repel from mouse, click = burst
  if(window.pJSDom&&window.pJSDom[0]){
    const pJS = window.pJSDom[0].pJS;
    pJS.interactivity.events.onhover.mode = 'repulse';
    pJS.interactivity.events.onclick.mode = 'push';
    pJS.interactivity.modes.repulse.distance = 180;
    pJS.interactivity.modes.push.particles_nb = 12;
  }

  // Steam-style Achievements
  let achievementsEnabled = localStorage.getItem('achievementsEnabled') !== 'false';
  const achievementsToggle = document.getElementById('achievements-toggle');
  if (achievementsToggle) {
    achievementsToggle.checked = achievementsEnabled;
    achievementsToggle.addEventListener('change', () => {
      achievementsEnabled = achievementsToggle.checked;
      localStorage.setItem('achievementsEnabled', achievementsEnabled);
      renderAchievements();
    });
  }
  function unlockAchievement(id) {
    if (!achievementsEnabled) return;
    const a = achievementsData.find(a => a.id === id);
    if (a && !a.unlocked) {
      a.unlocked = true;
      renderAchievements();
      // Show popup if enabled
      if (achievementsEnabled) showAchievementPopup(a);
    }
  }
  function renderAchievements() {
    const list = document.getElementById('achievements-list');
    if (!list) return;
    // Hide achievements if disabled
    list.style.display = achievementsEnabled ? '' : 'none';
    if (!achievementsEnabled) return;
    list.innerHTML = '';
    achievementsData.forEach(a => {
      const card = document.createElement('div');
      card.className = 'achievement-card';
      card.style.background = a.unlocked ? 'rgba(56,189,248,0.15)' : 'rgba(30,41,59,0.7)';
      card.style.border = a.unlocked ? '2px solid #38bdf8' : '2px solid #334155';
      card.style.borderRadius = '1rem';
      card.style.padding = '1.2rem';
      card.style.display = 'flex';
      card.style.alignItems = 'center';
      card.style.gap = '1.2rem';
      card.style.opacity = a.unlocked ? '1' : '0.5';
      // Trophy system
      let trophy = '';
      if ([
        'firstClick','tenClicks','playMaze','playPacman','builder','memory','themeSwitch'
      ].includes(a.id)) trophy = '🥉'; // bronze
      else if ([
        'motivateAward','connectNom','inspireAward','controlAward','thinkTop3'
      ].includes(a.id)) trophy = '🥈'; // silver
      else if ([
        'stateQual','top5Area','perfectJournal'
      ].includes(a.id)) trophy = '🥇'; // gold
      else if (a.id === 'worlds') trophy = '💎'; // diamond
      card.innerHTML = `<span style="font-size:2.5rem;">${a.unlocked ? a.icon : trophy}</span>
        <div><div style="font-size:1.2rem;font-weight:bold;color:#38bdf8;">${a.name}</div>
        <div style="color:#f1f5f9;">${a.desc}</div></div>`;
      list.appendChild(card);
    });
  }

  // Ensure launchGame function is present and global
  function launchGame(game) {
    let modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100vw';
    modal.style.height = '100vh';
    modal.style.background = 'rgba(10,20,40,0.92)';
    modal.style.zIndex = '10000';
    modal.style.display = 'flex';
    modal.style.flexDirection = 'column';
    modal.style.alignItems = 'center';
    modal.style.justifyContent = 'center';
    // Music URLs (public domain/CC0)
    const musicTracks = {
      'surge-maze': 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b9b6b2.mp3',
      'pacman': 'https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7c7.mp3',
      'robot-builder': 'https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b9b6b2.mp3',
      'memory-circuit': 'https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b7b7b.mp3',
    };
    let music = document.createElement('audio');
    music.src = musicTracks[game] || '';
    music.loop = true;
    music.volume = 0.25;
    music.autoplay = true;
    music.style.display = 'none';
    modal.appendChild(music);
    let isMuted = false;
    // Mute/unmute button
    let muteBtn = document.createElement('button');
    muteBtn.innerHTML = '🔊';
    muteBtn.title = 'Mute/Unmute Music';
    muteBtn.style.position = 'absolute';
    muteBtn.style.top = '2rem';
    muteBtn.style.left = '2rem';
    muteBtn.style.background = '#222';
    muteBtn.style.color = '#fff';
    muteBtn.style.fontSize = '1.5rem';
    muteBtn.style.padding = '0.5rem 1.2rem';
    muteBtn.style.border = 'none';
    muteBtn.style.borderRadius = '0.7rem';
    muteBtn.style.cursor = 'pointer';
    muteBtn.style.zIndex = '10001';
    muteBtn.onclick = () => {
      isMuted = !isMuted;
      music.muted = isMuted;
      muteBtn.innerHTML = isMuted ? '🔇' : '🔊';
    };
    modal.appendChild(muteBtn);
    // Close button
    modal.innerHTML += `<button onclick="this.parentElement.remove();window.__activeGameCleanup&&window.__activeGameCleanup();" style="position:absolute;top:2rem;right:2rem;background:#222;color:#fff;font-size:1.5rem;padding:0.5rem 1.2rem;border:none;border-radius:0.7rem;cursor:pointer;z-index:10001;">✕</button>`;
    let container = document.createElement('div');
    container.style.background = 'rgba(30,41,59,0.98)';
    container.style.padding = '2rem';
    container.style.borderRadius = '1.5rem';
    container.style.boxShadow = '0 8px 32px #000';
    container.style.display = 'flex';
    container.style.flexDirection = 'column';
    container.style.alignItems = 'center';
    container.style.justifyContent = 'center';
    container.style.minWidth = '320px';
    container.style.minHeight = '320px';
    container.style.maxWidth = '90vw';
    container.style.maxHeight = '80vh';
    container.style.overflow = 'auto';
    // INSTANT BOOT for surge-maze and pacman
    if (game === 'surge-maze') {
      container.innerHTML = `<h2 style='color:#38bdf8'>Surge Maze Game</h2><div id='surge-maze-modal'></div>`;
      modal.appendChild(container);
      document.body.appendChild(modal);
      if (window.__activeGameCleanup) window.__activeGameCleanup();
      window.__activeGameCleanup = () => { try { music.pause(); music.src = ''; } catch(e){} };
      setTimeout(() => startPacmanGameHD(document.getElementById('surge-maze-modal')), 0);
      window.__activeGameCleanup = () => {
        let c = document.getElementById('surge-maze-canvas');
        if (c) c.remove();
        try { music.pause(); music.src = ''; } catch(e){}
      };
      return;
    } else if (game === 'pacman') {
      container.innerHTML = `<h2 style='color:#fbbf24'>Pac-Man: Surge Edition</h2><div id='pacman-modal'></div>`;
      modal.appendChild(container);
      document.body.appendChild(modal);
      if (window.__activeGameCleanup) window.__activeGameCleanup();
      window.__activeGameCleanup = () => { try { music.pause(); music.src = ''; } catch(e){} };
      setTimeout(() => startPacmanGameHD(document.getElementById('pacman-modal')), 0);
      window.__activeGameCleanup = () => {
        let c = document.getElementById('pacman-canvas');
        if (c) c.remove();
        try { music.pause(); music.src = ''; } catch(e){}
      };
      return;
    }
    // For other games, show spinner and delay
    container.innerHTML = `<div id='game-loading-spinner' style='color:#38bdf8;font-size:2rem;text-align:center;'><svg width='48' height='48' viewBox='0 0 48 48' style='margin-bottom:1rem;'><circle cx='24' cy='24' r='20' stroke='#38bdf8' stroke-width='4' fill='none' stroke-dasharray='31.4 31.4' stroke-linecap='round'><animateTransform attributeName='transform' type='rotate' from='0 24 24' to='360 24 24' dur='1s' repeatCount='indefinite'/></circle></svg><div>Loading...</div></div>`;
    modal.appendChild(container);
    document.body.appendChild(modal);
    if (window.__activeGameCleanup) window.__activeGameCleanup();
    window.__activeGameCleanup = () => { try { music.pause(); music.src = ''; } catch(e){} };
    setTimeout(() => {
      window.__activeGameCleanup = () => { try { music.pause(); music.src = ''; } catch(e){} };
      if (game === 'robot-builder') {
        container.innerHTML = `<h2 style='color:#7c3aed'>Robot Builder</h2><div id='robot-builder-modal'></div>`;
        setTimeout(() => {
          startRobotBuilderGame(document.getElementById('robot-builder-modal'));
          window.__activeGameCleanup = () => {
            let c = document.getElementById('robot-builder-canvas');
            if (c) c.remove();
            try { music.pause(); music.src = ''; } catch(e){}
          };
        }, 50);
      } else if (game === 'memory-circuit') {
        container.innerHTML = `<h2 style='color:#0ea5e9'>Memory Circuit</h2><div id='memory-circuit-modal'></div>`;
        setTimeout(() => {
          startMemoryCircuitGame(document.getElementById('memory-circuit-modal'));
          window.__activeGameCleanup = () => {
            let c = document.getElementById('memory-circuit-canvas');
            if (c) c.remove();
            try { music.pause(); music.src = ''; } catch(e){}
          };
        }, 50);
      }
    }, 10);
  }
  // Lightweight Robot Builder game
  function startRobotBuilderGame(container) {
    container.innerHTML = `<canvas id='robot-builder-canvas' width='400' height='320' style='background:#181f2e;border-radius:1rem;box-shadow:0 0 24px #7c3aed;width:100%;max-width:400px;max-height:60vw;outline:none;'></canvas><div style='color:#fff;margin-top:1rem;'>Drag the parts to build your robot!</div>`;
    const canvas = container.querySelector('#robot-builder-canvas');
    const ctx = canvas.getContext('2d');
    // Simple drag-and-drop robot parts
    const parts = [
      {x:40,y:220,w:60,h:60,color:'#38bdf8',drag:false}, // body
      {x:60,y:120,w:20,h:60,color:'#7c3aed',drag:false}, // head
      {x:20,y:250,w:20,h:40,color:'#fbbf24',drag:false}, // left leg
      {x:100,y:250,w:20,h:40,color:'#fbbf24',drag:false}, // right leg
      {x:20,y:180,w:20,h:40,color:'#0ea5e9',drag:false}, // left arm
      {x:100,y:180,w:20,h:40,color:'#0ea5e9',drag:false}, // right arm
    ];
    let dragging = null, offsetX=0, offsetY=0;
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(const p of parts) {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x,p.y,p.w,p.h);
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(p.x,p.y,p.w,p.h);
      }
    }
    draw();
    canvas.onmousedown = e => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left, my = e.clientY - rect.top;
      for(let i=parts.length-1;i>=0;i--) {
        const p = parts[i];
        if(mx>=p.x&&mx<=p.x+p.w&&my>=p.y&&my<=p.y+p.h) {
          dragging = p; offsetX=mx-p.x; offsetY=my-p.y; break;
        }
      }
    };
    canvas.onmousemove = e => {
      if(dragging) {
        const rect = canvas.getBoundingClientRect();
        dragging.x = e.clientX-rect.left-offsetX;
        dragging.y = e.clientY-rect.top-offsetY;
        draw();
      }
    };
    canvas.onmouseup = () => { dragging=null; };
    canvas.onmouseleave = () => { dragging=null; };
  }
  // Lightweight Memory Circuit game
  function startMemoryCircuitGame(container) {
    container.innerHTML = `<canvas id='memory-circuit-canvas' width='400' height='320' style='background:#181f2e;border-radius:1rem;box-shadow:0 0 24px #0ea5e9;width:100%;max-width:400px;max-height:60vw;outline:none;'></canvas><div style='color:#fff;margin-top:1rem;'>Flip the cards to match all pairs!</div>`;
    const canvas = container.querySelector('#memory-circuit-canvas');
    const ctx = canvas.getContext('2d');
    const cols=4, rows=3, total=cols*rows;
    let values = Array.from({length:total/2},(_,i)=>i+1).flatMap(x=>[x,x]);
    values = values.sort(()=>Math.random()-0.5);
    let cards = values.map((v,i)=>({v,flipped:false,found:false}));
    let first=null, second=null, lock=false;
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=0;i<total;i++) {
        const x = (i%cols)*90+20, y = Math.floor(i/cols)*90+20;
        ctx.save();
        ctx.translate(x,y);
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(0,0,60,60);
        if(cards[i].flipped||cards[i].found) {
          ctx.fillStyle = '#7c3aed';
          ctx.fillRect(0,0,60,60);
          ctx.fillStyle = '#fff';
          ctx.font = 'bold 2rem Orbitron, sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(cards[i].v,30,32);
        } else {
          ctx.fillStyle = '#222';
          ctx.fillRect(0,0,60,60);
        }
        ctx.restore();
      }
    }
    draw();
    canvas.onclick = e => {
      if(lock) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX-rect.left, my = e.clientY-rect.top;
      for(let i=0;i<total;i++) {
        const x = (i%cols)*90+20, y = Math.floor(i/cols)*90+20;
        if(mx>=x&&mx<=x+60&&my>=y&&my<=y+60&&!cards[i].flipped&&!cards[i].found) {
          if(!first) { cards[i].flipped=true; first=i; }
          else if(!second) { cards[i].flipped=true; second=i; lock=true; setTimeout(()=>{
            if(cards[first].v===cards[second].v) { cards[first].found=cards[second].found=true; }
            else { cards[first].flipped=cards[second].flipped=false; }
            first=second=null; lock=false; draw();
          },700); }
          draw();
          break;
        }
      }
    };
  }

  // --- Achievements Data and Popup ---
  const achievementsData = [
    { id: 'firstClick', name: 'First Click!', desc: 'You clicked Surge for the first time.', icon: '👆', unlocked: false },
    { id: 'tenClicks', name: 'Click Master', desc: 'You clicked Surge 10 times!', icon: '🔟', unlocked: false },
    { id: 'playMaze', name: 'Maze Runner', desc: 'You played Surge Maze.', icon: '🌀', unlocked: false },
    { id: 'playPacman', name: 'Pac-Maniac', desc: 'You played Pac-Man: Surge Edition.', icon: '🟡', unlocked: false },
    { id: 'builder', name: 'Robot Builder', desc: 'You built a robot in Robot Builder.', icon: '🤖', unlocked: false },
    { id: 'memory', name: 'Circuit Memory', desc: 'You played Memory Circuit.', icon: '💾', unlocked: false },
    { id: 'themeSwitch', name: 'Theme Switcher', desc: 'You toggled the site theme.', icon: '🌓', unlocked: false },
    // New team achievements (least to greatest difficulty)
    { id: 'motivateAward', name: 'Motivate Award Winner', desc: 'Win the Motivate Award at a qualifier.', icon: '🏅', unlocked: false },
    { id: 'connectNom', name: 'Connect Award Nominee', desc: 'Be nominated for the Connect Award.', icon: '🤝', unlocked: false },
    { id: 'inspireAward', name: 'Inspire Award Winner', desc: 'Win the Inspire Award.', icon: '🏆', unlocked: false },
    { id: 'controlAward', name: 'Control Award Winner', desc: 'Receive the Control Award.', icon: '🎮', unlocked: false },
    { id: 'thinkTop3', name: 'Think Award Top 3', desc: 'Place in top 3 for Think Award at State Championship.', icon: '📓', unlocked: false },
    { id: 'stateQual', name: 'State Championship Qualifier', desc: 'Qualify for the State Championship.', icon: '🎫', unlocked: false },
    { id: 'top5Area', name: 'Top 5 in Area', desc: 'Be ranked in the top 5 teams in our area.', icon: '🥇', unlocked: false },
    { id: 'perfectJournal', name: 'Perfect Journal Review', desc: 'Receive a perfect journal review.', icon: '📝', unlocked: false },
    { id: 'worlds', name: 'Worlds Qualifier', desc: 'Advance to Worlds.', icon: '🌎', unlocked: false },
  ];
  function showAchievementPopup(a) {
    const popup = document.createElement('div');
    popup.style.position = 'fixed';
    popup.style.bottom = '40px';
    popup.style.right = '40px';
    popup.style.background = 'rgba(30,41,59,0.97)';
    popup.style.color = '#38bdf8';
    popup.style.padding = '1.2rem 2rem';
    popup.style.borderRadius = '1.2rem';
    popup.style.boxShadow = '0 2px 12px #38bdf8';
    popup.style.fontFamily = 'Orbitron, sans-serif';
    popup.style.fontSize = '1.2rem';
    popup.style.zIndex = '10003';
    popup.style.display = 'flex';
    popup.style.alignItems = 'center';
    popup.style.gap = '1.2rem';
    popup.innerHTML = `<span style="font-size:2.5rem;">${a.icon}</span> <span><b>${a.name}</b><br><span style='font-size:1rem;color:#f1f5f9;'>${a.desc}</span></span>`;
    document.body.appendChild(popup);
    setTimeout(() => { popup.style.opacity = '0'; popup.style.transition = 'opacity 0.7s'; }, 2200);
    setTimeout(() => { popup.remove(); }, 3000);
  }

  document.addEventListener('DOMContentLoaded', () => {
    // ... existing code ...
    // Sponsors
    document.querySelectorAll('.sponsors-grid img').forEach((img, i) => {
      const unsplash = [
        'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80',
        'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80',
        'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80',
        'https://images.unsplash.com/photo-1521737852567-6949f3f9f2b5?auto=format&fit=crop&w=400&q=80',
      ];
      img.src = unsplash[i % unsplash.length];
    });
    // Pit tour images
    const pitImgs = document.querySelectorAll('#pit-tour-grid img');
    const pitUnsplash = [
      'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?auto=format&fit=crop&w=400&q=80', // Robot
      'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80', // Field
      'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=400&q=80', // Team Station
    ];
    pitImgs.forEach((img, i) => { img.src = pitUnsplash[i % pitUnsplash.length]; });
  });

  // --- Maze Game ---
  function startMazeGame(container) {
    // Simple Maze Game with Random Maze Generation
    container.innerHTML = `<canvas id="surge-maze-canvas" tabindex="0" aria-label="Surge Maze Game" style="background:#030711;border-radius:1rem;box-shadow:0 0 24px #38bdf8;width:100%;max-width:600px;max-height:80vw;outline:none;"></canvas>\n<div id="surge-maze-ui" style="color:#fff;text-align:center;margin-top:1rem;"></div>`;
    const canvas = container.querySelector('#surge-maze-canvas');
    const ctx = canvas.getContext('2d');
    // Responsive sizing
    function resizeCanvas() {
      let w = Math.min(600, window.innerWidth * 0.95);
      let h = Math.min(500, window.innerHeight * 0.7);
      canvas.width = w;
      canvas.height = h;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    // Maze generation (recursive backtracking)
    const MAZE_ROWS = 15, MAZE_COLS = 21;
    function generateMaze(rows, cols) {
      let maze = Array.from({length: rows}, () => Array(cols).fill(0));
      function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }
      function carve(x, y) {
        maze[y][x] = 1;
        let dirs = [[0,-2],[2,0],[0,2],[-2,0]];
        shuffle(dirs);
        for (const [dx, dy] of dirs) {
          let nx = x + dx, ny = y + dy;
          if (ny > 0 && ny < rows && nx > 0 && nx < cols && maze[ny][nx] === 0) {
            maze[y + dy/2][x + dx/2] = 1;
            carve(nx, ny);
          }
        }
      }
      carve(1, 1);
      maze[1][1] = 1; // Start
      maze[rows-2][cols-2] = 1; // Exit
      return maze;
    }
    let maze = generateMaze(MAZE_ROWS, MAZE_COLS);
    let cellSize = Math.min(canvas.width / MAZE_COLS, canvas.height / MAZE_ROWS);
    let player = {x: 1, y: 1};
    let exit = {x: MAZE_COLS-2, y: MAZE_ROWS-2};
    let gameOver = false;
    function drawMaze() {
      for (let y = 0; y < MAZE_ROWS; y++) for (let x = 0; x < MAZE_COLS; x++) {
        if (maze[y][x] === 0) {
          ctx.fillStyle = '#0ea5e9';
          ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        }
      }
      ctx.save();
      ctx.fillStyle = '#fbbf24';
      ctx.beginPath();
      ctx.arc(exit.x * cellSize + cellSize/2, exit.y * cellSize + cellSize/2, cellSize/3, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
    function drawSurge(px, py) {
      ctx.save();
      ctx.translate(px * cellSize + cellSize/2, py * cellSize + cellSize/2);
      ctx.beginPath();
      ctx.arc(0, 0, cellSize/2-2, 0, Math.PI*2);
      ctx.fillStyle = '#38bdf8';
      ctx.shadowColor = '#7c3aed';
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.beginPath(); ctx.arc(-cellSize/5,-cellSize/6,cellSize/8,0,Math.PI*2); ctx.arc(cellSize/5,-cellSize/6,cellSize/8,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
      ctx.beginPath(); ctx.arc(-cellSize/5,-cellSize/7,cellSize/20,0,Math.PI); ctx.arc(cellSize/5,-cellSize/7,cellSize/20,0,Math.PI); ctx.strokeStyle='#222'; ctx.lineWidth=cellSize/30; ctx.stroke();
      ctx.beginPath(); ctx.arc(0,cellSize/7,cellSize/4,0,Math.PI,false); ctx.strokeStyle='#fff'; ctx.lineWidth=cellSize/18; ctx.stroke();
      ctx.restore();
    }
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      cellSize = Math.min(canvas.width / MAZE_COLS, canvas.height / MAZE_ROWS);
      drawMaze();
      drawSurge(player.x, player.y);
    }
    function canMove(x, y) {
      return maze[y] && maze[y][x] === 1;
    }
    function movePlayer(dx, dy) {
      if (canMove(player.x + dx, player.y + dy)) {
        player.x += dx; player.y += dy;
        if (player.x === exit.x && player.y === exit.y) {
          gameOver = true;
          showEndScreen();
        }
      }
    }
    function showEndScreen() {
      const ui = container.querySelector('#surge-maze-ui');
      ui.innerHTML = `<h3 style='color:#38bdf8'>You Win! Surge escaped the maze!</h3><button id='play-again-btn' style='margin:1rem 0.5rem 0 0;background:#38bdf8;color:#030711;font-weight:bold;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;'>Play Again</button><button id='close-game-btn' style='margin:1rem 0 0 0.5rem;background:#222;color:#fff;font-size:1.1rem;padding:0.6rem 2rem;border:none;border-radius:0.7rem;cursor:pointer;'>Close</button>`;
      document.getElementById('play-again-btn').onclick = () => { startMazeGame(container); };
      document.getElementById('close-game-btn').onclick = () => { container.parentElement.parentElement.remove(); };
    }
    canvas.focus();
    canvas.setAttribute('role','application');
    canvas.setAttribute('aria-label','Surge Maze Game');
    canvas.addEventListener('keydown', function handler(e) {
      if (gameOver) return;
      if(['ArrowUp','w','W'].includes(e.key)) movePlayer(0, -1);
      else if(['ArrowDown','s','S'].includes(e.key)) movePlayer(0, 1);
      else if(['ArrowLeft','a','A'].includes(e.key)) movePlayer(-1, 0);
      else if(['ArrowRight','d','D'].includes(e.key)) movePlayer(1, 0);
      draw();
    });
    draw();
    const ui = container.querySelector('#surge-maze-ui');
    ui.innerHTML = `<b>Goal:</b> Help Surge reach the yellow exit!`;
  }

  // --- Pac-Man: Surge Edition ---
  function startPacmanGame(container) {
    // FULL Classic Pac-Man: Surge Edition (production-quality, themed)
    container.innerHTML = `
      <canvas id="pacman-canvas" tabindex="0" aria-label="Pac-Man: Surge Edition" style="background:#181f2e;border-radius:1rem;box-shadow:0 0 24px #38bdf8;width:100%;max-width:560px;max-height:90vw;outline:none;display:block;margin:auto;position:relative;z-index:1;pointer-events:auto;"></canvas>
      <div style="color:#fbbf24; font-size:1rem; text-align:center; margin-top:0.5rem;">Click the game area if arrow keys don't work!</div>
      <div id="pacman-ui" style="color:#fff;text-align:center;margin-top:1rem;"></div>`;
    const canvas = container.querySelector('#pacman-canvas');
    const ctx = canvas.getContext('2d');
    canvas.setAttribute('tabindex', '0');
    canvas.focus();
    // If canvas loses focus, refocus on click
    canvas.addEventListener('click', () => canvas.focus());
    // --- Game Constants ---
    const ROWS = 31;
    const COLS = 28;
    let W = Math.min(560, window.innerWidth * 0.98);
    let H = Math.min(620, window.innerHeight * 0.85);
    canvas.width = W;
    canvas.height = H;
    const CELL = Math.min(canvas.width / COLS, canvas.height / ROWS);
    window.addEventListener('resize', () => {
      W = Math.min(560, window.innerWidth * 0.98);
      H = Math.min(620, window.innerHeight * 0.85);
      canvas.width = W;
      canvas.height = H;
      CELL = Math.min(canvas.width / COLS, canvas.height / ROWS);
    });
    // --- Maze Layout (classic, simplified for brevity) ---
    // 0=wall, 1=dot, 2=empty, 3=power, 4=door, 5=bonus
    const MAZE = [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0],
      [0,3,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,3,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0],
      [0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0],
      [0,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],
      [0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],
      [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];
    // --- Game State ---
    let maze = MAZE.map(row => row.slice());
    let player = {
      x: 15, y: 11, dir: {x:0, y:0}, nextDir: {x:0, y:0}, speed: PLAYER_SPEED, 
      powered: 0, alive: true, score: 0, color: '#38bdf8'
    };



    let ghosts = [
      {x: 13, y: 4, dir: {x:0, y:1}, color: '#f43f5e', scatter:{x:1,y:1}, speed: GHOST_SPEED, mode:'chase', name:'Blinky'},
      {x: 11, y: 4, dir: {x:1, y:0}, color: '#fbbf24', scatter:{x:26,y:1}, speed: GHOST_SPEED, mode:'random', name:'Pinky'},
      {x: 15, y: 4, dir: {x:-1, y:0}, color: '#38bdf8', scatter:{x:1,y:29}, speed: GHOST_SPEED, mode:'scatter', name:'Inky'},
      {x: 13, y: 9, dir: {x:0, y:1}, color: '#7c3aed', scatter:{x:26,y:29}, speed: GHOST_SPEED, mode:'random', name:'Clyde'}
    ];
    let bonus = {x: 13.5, y: 17, active: false, timer: 0};
    let dots = 0;
    for (let row of maze) for (let cell of row) if (cell === 1) dots++;
    let gameOver = false;
    // --- Drawing Functions ---
    function drawWrench(x, y) {
      ctx.save();
      const centerX = x * CELL + CELL / 2;
      const centerY = y * CELL + CELL / 2;
      const size = CELL * 0.8;
      
      // Create gradient for the wrench
      const gradient = ctx.createRadialGradient(
        centerX - size/4, centerY - size/4, 0,
        centerX, centerY, size
      );
      gradient.addColorStop(0, '#fbbf24');
      gradient.addColorStop(1, '#d97706');
      
      // Draw the wrench head (circle)
      ctx.beginPath();
      ctx.arc(centerX, centerY, size * 0.25, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.shadowColor = '#fbbf24';
      ctx.shadowBlur = 8;
      ctx.fill();
      
      // Draw the wrench handle
      ctx.beginPath();
      // Main handle
      ctx.roundRect(
        centerX - size * 0.05, 
        centerY - size * 0.1,
        size * 0.6, 
        size * 0.2, 
        [size * 0.1, size * 0.1, size * 0.1, size * 0.1]
      );
      
      // End of the handle
      ctx.arc(
        centerX + size * 0.55, 
        centerY, 
        size * 0.15, 
        -Math.PI/2, 
        Math.PI/2
      );
      
      // Cutout in the head
      ctx.moveTo(centerX, centerY - size * 0.15);
      ctx.arc(centerX, centerY, size * 0.15, -Math.PI/2, Math.PI/2, true);
      
      ctx.fillStyle = gradient;
      ctx.fill();
      
      // Add some highlights
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
      ctx.lineWidth = 1;
      ctx.stroke();
      
      ctx.restore();
    }
    function drawLightning(x, y, big) {
      ctx.save();
      ctx.translate(x*CELL+CELL/2, y*CELL+CELL/2);
      const scale = big ? 1.5 : 0.8; // Make regular dots smaller
      ctx.scale(scale, scale);
      
      // Simpler lightning bolt shape that's less resource-intensive
      ctx.beginPath();
      if (big) {
        // Bigger, more detailed lightning for power pellets
        ctx.moveTo(-CELL/10, -CELL/5);
        ctx.lineTo(0, 0);
        ctx.lineTo(CELL/10, CELL/5);
        ctx.lineTo(0, CELL/10);
        ctx.lineTo(CELL/8, CELL/4);
        ctx.lineTo(-CELL/12, 0);
        ctx.closePath();
      } else {
        // Simpler shape for regular dots
        ctx.moveTo(0, -CELL/6);
        ctx.lineTo(CELL/8, 0);
        ctx.lineTo(0, CELL/6);
        ctx.lineTo(-CELL/8, 0);
        ctx.closePath();
      }
      
      ctx.fillStyle = big ? '#fbbf24' : 'rgba(251, 191, 36, 0.8)';
      ctx.strokeStyle = big ? '#fff' : 'rgba(255, 255, 255, 0.8)';
      ctx.lineWidth = big ? 2 : 1;
      ctx.fill();
      if (big) ctx.stroke();
      
      // Add a subtle glow for power pellets
      if (big) {
        ctx.shadowColor = '#fbbf24';
        ctx.shadowBlur = 8;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
      
      ctx.restore();
    }
    function drawWrench(x, y) {
      ctx.save();
      ctx.translate(x*CELL+CELL/2, y*CELL+CELL/2);
      ctx.rotate(Math.PI/6);
      ctx.beginPath();
      ctx.moveTo(-CELL/6, 0);
      ctx.lineTo(CELL/6, 0);
      ctx.lineWidth = 4;
      ctx.strokeStyle = '#aaa';
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(CELL/6, 0, CELL/8, Math.PI/2, Math.PI*1.5);
      ctx.stroke();
      ctx.restore();
    }
    function drawBoard() {
      for (let y = 0; y < ROWS; y++) for (let x = 0; x < COLS; x++) {
        if (maze[y][x] === 0) drawWall(x, y);
        else if (maze[y][x] === 1) drawLightning(x, y, false);
        else if (maze[y][x] === 3) drawLightning(x, y, true);
        else if (maze[y][x] === 5) drawWrench(x, y);
      }
    }
    function drawSurge(px, py, powered) {
      ctx.save();
      const centerX = px * CELL + CELL / 2;
      const centerY = py * CELL + CELL / 2;
      const radius = CELL * 0.4;
      
      // Body with gradient
      const gradient = ctx.createRadialGradient(
        centerX - radius/2, centerY - radius/2, 0,
        centerX, centerY, radius * 1.5
      );
      gradient.addColorStop(0, powered ? '#a78bfa' : player.color);
      gradient.addColorStop(1, powered ? '#7c3aed' : '#1d4ed8');
      
      // Draw main body
      ctx.beginPath();
      let mouthOpen = Math.PI / 4;
      let rotation = Math.atan2(player.dir.y, player.dir.x);
      if (player.dir.x === 0 && player.dir.y === 0) rotation = 0;
      
      ctx.translate(centerX, centerY);
      ctx.rotate(rotation);
      
      // Draw body with mouth
      ctx.beginPath();
      ctx.arc(0, 0, radius, mouthOpen, Math.PI * 2 - mouthOpen);
      ctx.lineTo(radius * 0.3, 0);
      ctx.closePath();
      
      ctx.fillStyle = gradient;
      ctx.shadowColor = powered ? '#7c3aed' : player.color;
      ctx.shadowBlur = 10;
      ctx.fill();
      
      // Eye
      ctx.beginPath();
      ctx.arc(radius * 0.3, -radius * 0.2, radius * 0.15, 0, Math.PI * 2);
      ctx.fillStyle = '#1e1b4b';
      ctx.fill();
      
      ctx.restore();
    }
    function drawGhost(g, frightened) {
      ctx.save();
      const centerX = g.x * CELL + CELL / 2;
      const centerY = g.y * CELL + CELL / 2;
      const radius = CELL * 0.4;
      
      // Body gradient
      const bodyGradient = ctx.createRadialGradient(
        centerX - radius, centerY - radius, 0,
        centerX, centerY, radius * 2
      );
      
      if (frightened) {
        bodyGradient.addColorStop(0, '#818cf8');
        bodyGradient.addColorStop(1, '#4f46e5');
      } else {
        bodyGradient.addColorStop(0, g.color);
        bodyGradient.addColorStop(1, g.color.replace(')', ', 0.8)'));
      }
      
      // Draw ghost body
      ctx.beginPath();
      ctx.arc(centerX, centerY - radius/2, radius, Math.PI, 0, false);
      
      // Wavy bottom
      const bottomY = centerY + radius/2;
      ctx.lineTo(centerX + radius, bottomY - 2);
      
      // Create wavy bottom
      const waveSize = 4;
      const segments = 4;
      for (let i = 0; i <= segments; i++) {
        const x = centerX + radius - (i * (radius * 2) / segments);
        const y = bottomY + (i % 2 === 0 ? 0 : waveSize);
        ctx.lineTo(x, y);
      }
      
      ctx.fillStyle = bodyGradient;
      ctx.shadowColor = frightened ? '#818cf8' : g.color;
      ctx.shadowBlur = 10;
      ctx.fill();
      
      // Eyes
      const eyeRadius = radius * 0.25;
      const leftEyeX = centerX - radius * 0.3;
      const rightEyeX = centerX + radius * 0.3;
      const eyeY = centerY - radius * 0.2;
      
      // Draw eyes
      function drawEye(x, y) {
        ctx.beginPath();
        ctx.arc(x, y, eyeRadius, 0, Math.PI * 2);
        ctx.fillStyle = 'white';
        ctx.fill();
        
        // Draw pupil
        ctx.beginPath();
        ctx.arc(x, y, eyeRadius * 0.5, 0, Math.PI * 2);
        ctx.fillStyle = 'black';
        ctx.fill();
      }
      
      drawEye(leftEyeX, eyeY);
      drawEye(rightEyeX, eyeY);
      
      ctx.restore();
    }
    // --- Movement and Logic ---
    function isWall(x, y) {
      // Check all four corners of the player's hitbox
      const radius = 0.4; // Player's collision radius (smaller than cell size)
      const positions = [
        [x - radius, y - radius], // top-left
        [x + radius, y - radius], // top-right
        [x - radius, y + radius], // bottom-left
        [x + radius, y + radius]  // bottom-right
      ];
      
      // If any corner is in a wall, it's a collision
      return positions.some(([cx, cy]) => {
        const cellX = Math.round(cx);
        const cellY = Math.round(cy);
        return maze[cellY] && maze[cellY][cellX] === 0;
      });
    }
    
    function canMove(x, y, dir) {
      // Check if we can move in the given direction
      const newX = x + dir.x * 0.1; // Small step in direction
      const newY = y + dir.y * 0.1;
      return !isWall(newX, newY);
    }
    function updatePlayer() {
      if (!player.alive || gameOver) return; // Don't update if game is over
      
      // Try to turn if possible
      if (player.nextDir.x !== 0 || player.nextDir.y !== 0) {
        // Check if we can move in the new direction
        const nextX = player.x + player.nextDir.x;
        const nextY = player.y + player.nextDir.y;
        
        // Only change direction if we're aligned with the grid or can move in the new direction
        const currentX = Math.round(player.x);
        const currentY = Math.round(player.y);
        const alignedX = Math.abs(player.x - currentX) < 0.1;
        const alignedY = Math.abs(player.y - currentY) < 0.1;
        
        if ((alignedX && alignedY) || !isWall(nextX, nextY)) {
          player.dir = {...player.nextDir};
        }
      }
      
      // Slow down the player slightly
      const adjustedSpeed = player.speed * 0.8;
      
      // Calculate potential new position
      let newX = player.x + player.dir.x * adjustedSpeed;
      let newY = player.y + player.dir.y * adjustedSpeed;
      
      // Check if we can move in the current direction
      if (!isWall(newX, newY)) {
        player.x = newX;
        player.y = newY;
      } else {
        // Try to align with the grid if we hit a wall
        if (player.dir.x !== 0) {
          player.x = Math.round(player.x * 2) / 2;
        }
        if (player.dir.y !== 0) {
          player.y = Math.round(player.y * 2) / 2;
        }
      }
      
      // Handle screen wrapping (tunnels)
      if (player.x < 0) player.x = COLS - 1;
      if (player.x >= COLS) player.x = 0;
      
      // Only process scoring if the game is still active
      if (player.alive && !gameOver) {
        // Eat dots/pellets/bonus
        let cx = Math.round(player.x), cy = Math.round(player.y);
        if (maze[cy] && maze[cy][cx] === 1) { maze[cy][cx] = 2; player.score++; dots--; }
        if (maze[cy] && maze[cy][cx] === 3) { maze[cy][cx] = 2; player.powered = 120; }
        if (maze[cy] && maze[cy][cx] === 5) { maze[cy][cx] = 2; player.score += 10; bonus.active = false; }
      }
    }
    function updateGhost(g) {
      // At center of cell, pick new direction if needed
      let cx = Math.round(g.x), cy = Math.round(g.y);
      let centerX = Math.abs(g.x - cx) < 0.1;
      let centerY = Math.abs(g.y - cy) < 0.1;
      
      // Force movement if ghost is not moving
      if (g.dir.x === 0 && g.dir.y === 0) {
        let possibleDirs = [
          {x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}
        ].filter(d => !isWall(cx+d.x, cy+d.y));
        
        if (possibleDirs.length > 0) {
          g.dir = possibleDirs[Math.floor(Math.random()*possibleDirs.length)];
        }
      }
      
      if (centerX && centerY) {
        let dirs = [
          {x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}
        ].filter(d => !isWall(cx+d.x, cy+d.y) && !(d.x === -g.dir.x && d.y === -g.dir.y));
        
        if (dirs.length > 0) {
          let newDir;
          if (player.powered) {
            // When powered, ghosts should run away from player
            let bestDir = dirs[0];
            let bestDist = -Infinity;
            for (let dir of dirs) {
              let dx = player.x - (cx + dir.x);
              let dy = player.y - (cy + dir.y);
              let dist = dx*dx + dy*dy;
              if (dist > bestDist) {
                bestDist = dist;
                bestDir = dir;
              }
            }
            newDir = bestDir;
          } else if (g.mode === 'chase') {
            // Find direction to player
            let bestDir = dirs[0];
            let bestDist = Infinity;
            for (let dir of dirs) {
              let dx = player.x - (cx + dir.x);
              let dy = player.y - (cy + dir.y);
              let dist = dx*dx + dy*dy;
              if (dist < bestDist) {
                bestDist = dist;
                bestDir = dir;
              }
            }
            newDir = bestDir;
          } else if (g.mode === 'scatter') {
            // Move toward scatter target
            let bestDir = dirs[0];
            let bestDist = Infinity;
            for (let dir of dirs) {
              let dx = g.scatter.x - (cx + dir.x);
              let dy = g.scatter.y - (cy + dir.y);
              let dist = dx*dx + dy*dy;
              if (dist < bestDist) {
                bestDist = dist;
                bestDir = dir;
              }
            }
            newDir = bestDir;
          } else {
            // Random movement
            newDir = dirs[Math.floor(Math.random() * dirs.length)];
          }
          g.dir = newDir;
        }
      }
      
      // Move ghost
      let nx = g.x + g.dir.x * g.speed;
      let ny = g.y + g.dir.y * g.speed;
      if (!isWall(nx, ny)) {
        g.x = nx;
        g.y = ny;
      } else {
        // If ghost would hit a wall, pick a new random direction (not reverse)
        let possibleDirs = [
          {x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}
        ].filter(d => !isWall(cx+d.x, cy+d.y));
        
        if (possibleDirs.length > 0) {
          g.dir = possibleDirs[Math.floor(Math.random()*possibleDirs.length)];
        } else {
          // Last resort: try any direction that's not a wall
          g.dir = {x:0, y:0};
        }
      }
    }
    function checkCollisions() {
      for (let g of ghosts) {
        // Calculate distance between player and ghost
        let dx = player.x - g.x;
        let dy = player.y - g.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        
        // Collision distance threshold (slightly larger than before)
        if (dist < 0.8) {
          if (player.powered > 0) {
            // Player is powered up - ghost is eaten
            player.score += 100;
            g.x = 13.5;  // Move ghost back to ghost house
            g.y = 14;
            g.dir = {x:0, y:0};
          } else {
            // Player is not powered up - game over
            player.alive = false;
            gameOver = true;
            console.log('Game Over!');
            return; // Exit early since game is over
          }
        }
      }
    }
    // --- Event Listeners ---
    // Handle keyboard input
    if (!window._pacmanKeyListener) {
      window._pacmanKeyListener = true;
      
      // Keyboard input
      window.addEventListener('keydown', (e) => {
        // Only handle keys if Pac-Man canvas is present
        const pacmanCanvas = document.getElementById('pacman-canvas');
        if (pacmanCanvas && pacmanCanvas.offsetParent !== null) {
          // Handle arrow keys for movement
          if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) {
            e.preventDefault();
            // Only process movement if game is not over
            if (!gameOver && player.alive) {
              switch(e.key) {
                case 'ArrowUp': player.nextDir = {x:0, y:-1}; break;
                case 'ArrowDown': player.nextDir = {x:0, y:1}; break;
                case 'ArrowLeft': player.nextDir = {x:-1, y:0}; break;
                case 'ArrowRight': player.nextDir = {x:1, y:0}; break;
              }
            }
          } 
        }
      });
      
      // Mouse click handler for play again button
      window.addEventListener('click', (e) => {
        if (!gameOver || !window._playAgainButton) return;
        
        // Get canvas position
        const canvas = document.getElementById('pacman-canvas');
        if (!canvas) return;
        
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        // Check if click was on the play again button
        const btn = window._playAgainButton;
        if (x >= btn.x && x <= btn.x + btn.width && 
            y >= btn.y && y <= btn.y + btn.height) {
          resetGame();
        }
      });
      
      // Touch support for mobile
      window.addEventListener('touchend', (e) => {
        if (!gameOver || !window._playAgainButton) return;
        
        // Get canvas position
        const canvas = document.getElementById('pacman-canvas');
        if (!canvas) return;
        
        const rect = canvas.getBoundingClientRect();
        const touch = e.changedTouches[0];
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        
        // Check if touch was on the play again button
        const btn = window._playAgainButton;
        if (x >= btn.x && x <= btn.x + btn.width && 
            y >= btn.y && y <= btn.y + btn.height) {
          e.preventDefault();
          resetGame();
        }
      }, { passive: false });
    }
    
    // Reset the game state
    function resetGame() {
      // Reset player
      player.x = 15;
      player.y = 11;
      player.dir = {x: 0, y: 0};
      player.nextDir = {x: 0, y: 0};
      player.powered = 0;
      player.alive = true;
      player.score = 0; // Reset score
      
      // Reset ghosts
      ghosts = [
        {x: 13, y: 4, dir: {x:0, y:1}, color: '#f43f5e', scatter:{x:1,y:1}, speed: 0.10, mode:'chase', name:'Blinky'},
        {x: 11, y: 4, dir: {x:1, y:0}, color: '#fbbf24', scatter:{x:26,y:1}, speed: 0.10, mode:'random', name:'Pinky'},
        {x: 15, y: 4, dir: {x:-1, y:0}, color: '#38bdf8', scatter:{x:1,y:29}, speed: 0.10, mode:'scatter', name:'Inky'},
        {x: 13, y: 9, dir: {x:0, y:1}, color: '#7c3aed', scatter:{x:26,y:29}, speed: 0.10, mode:'random', name:'Clyde'}
      ];
      
      // Reset game state
      gameOver = false;
      dots = 0;
      
      // Reset maze and dots
      maze = MAZE.map(row => row.slice());
      for (let row of maze) for (let cell of row) if (cell === 1) dots++;
      
      // Reset bonus
      bonus.active = false;
      bonus.timer = 0;
    }
    
    // --- Main Game Loop ---
    function drawGameOver() {
      // Semi-transparent overlay
      ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Game Over text
      ctx.fillStyle = '#fff';
      ctx.font = '48px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      // Draw game over text with shadow
      ctx.shadowColor = '#000';
      ctx.shadowBlur = 10;
      ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2 - 50);
      
      // Score
      ctx.font = '24px Arial';
      ctx.fillText('Score: ' + player.score, canvas.width/2, canvas.height/2);
      
      // Draw play again button
      const buttonWidth = 200;
      const buttonHeight = 50;
      const buttonX = canvas.width/2 - buttonWidth/2;
      const buttonY = canvas.height/2 + 50;
      
      // Button background
      ctx.fillStyle = '#4CAF50';
      ctx.shadowBlur = 0;
      ctx.beginPath();
      const borderRadius = 10;
      ctx.roundRect(buttonX, buttonY, buttonWidth, buttonHeight, borderRadius);
      ctx.fill();
      
      // Button border
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Button text
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('PLAY AGAIN', canvas.width/2, buttonY + buttonHeight/2);
      
      // Store button position for click detection
      window._playAgainButton = {
        x: buttonX,
        y: buttonY,
        width: buttonWidth,
        height: buttonHeight
      };
    }

    function resetGame() {
      // Reset player
      player.x = 15;
      player.y = 11;
      player.dir = {x: 0, y: 0};
      player.nextDir = {x: 0, y: 0};
      player.alive = true;
      player.powered = 0;
      
      // Reset game state
      gameOver = false;
      
      // Reset ghosts
      ghosts = [
        {x: 13, y: 4, dir: {x:0, y:1}, color: '#f43f5e', scatter:{x:1,y:1}, speed: 0.10, mode:'chase', name:'Blinky'},
        {x: 11, y: 4, dir: {x:1, y:0}, color: '#fbbf24', scatter:{x:26,y:1}, speed: 0.10, mode:'random', name:'Pinky'},
        {x: 15, y: 4, dir: {x:-1, y:0}, color: '#38bdf8', scatter:{x:1,y:29}, speed: 0.10, mode:'scatter', name:'Inky'},
        {x: 13, y: 9, dir: {x:0, y:1}, color: '#7c3aed', scatter:{x:26,y:29}, speed: 0.10, mode:'random', name:'Clyde'}
      ];
      
      // Reset maze and dots
      maze = MAZE.map(row => row.slice());
      dots = 0;
      for (let row of maze) for (let cell of row) if (cell === 1) dots++;
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (!gameOver && player.alive) {
        // Update game state
        updatePlayer();
        ghosts.forEach(updateGhost);
        checkCollisions();
        
        // Draw everything
        drawBoard();
        drawSurge(player.x, player.y, player.powered > 0);
        ghosts.forEach(g => drawGhost(g, player.powered > 0));
        
        // Update power-up timer
        if (player.powered > 0) player.powered--;
      } else if (!player.alive) {
        // Draw game over screen
        drawBoard();
        drawSurge(player.x, player.y, player.powered > 0);
        ghosts.forEach(g => drawGhost(g, player.powered > 0));
        drawGameOver();
      }
      
      // Always continue the game loop for input handling
      requestAnimationFrame(gameLoop);
    }
    gameLoop();
    const ui = container.querySelector('#pacman-ui');
    ui.innerHTML = `<b>Goal:</b> Collect all the lightning bolts and avoid the ghosts!<br><span style='color:#7c3aed'>Eat a big lightning bolt to power up and chase the ghosts!<br>Collect the wrench for bonus points!</span><br><span style='color:#fbbf24'>Use arrow keys or WASD to move</span>`;
  }
  </script>
</body>
</html>
